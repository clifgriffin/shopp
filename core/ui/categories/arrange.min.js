jQuery(document).ready(function(){var t=jQuery;t.fn.dragRelatedRows=function(n){var e=t(this),o=e.is("table")?e.find("tbody tr"):e,r="undefined"!=typeof t(document).attr("onselectstart"),a={onDrop:function(){}},n=t.extend(a,n);return o.unbind("mousedown.dragrow").bind("mousedown.dragrow",function(e){var o=t(this),a=o.attr("rel"),s=o.attr("class").replace(" alternate","").split(" "),i="top"==s[s.length-1]&&s.pop(),d=("-child"==s[s.length-1].substr(-6)?s.pop():i,s.slice(0,-1)),l=o.add("tr."+a,o.parent());return!(!t(e.target).is("input,button")&&o.attr("class"))||(l.not(":hidden").fadeTo("fast",.4),lastY=e.pageY,t("tr",l.parent()).not(l).bind("mouseenter.dragrow",function(n){var e=t(this),o=e.attr("class").replace(" alternate","").split(" "),r="top"==o[o.length-1]&&o.pop(),a=("-child"==o[o.length-1].substr(-6)?o.pop():r,o.slice(0,-1)),s=(a[a.length-1],t("tr."+e.attr("rel")+":last",l.parent()));return a.toString()!=d.toString()?lastY=n.pageY:(n.pageY>lastY?s.after(l):e.before(l),void(lastY=n.pageY))}),t("body").bind("mouseup.dragrow",function(){l.not(":hidden").fadeTo("fast",1),t("tr",l.parent()).unbind("mouseenter.dragrow"),t("body").unbind("mouseup.dragrow"),r&&t(document).unbind("selectstart"),n.onDrop(l)}),e.preventDefault(),r&&t(document).bind("selectstart",function(){return!1}),!1)}).css("cursor","row-resize")},t.fn.arrangeRow=function(n){function e(t){t.is("tr")?(r=t,cell=!1):(cell=t.parent(),r=t.parent().parent()),a=r.find("input[name=id]").val(),h=r.find("input[name^=position]").val(),s=r.attr("rel"),i=r.attr("class").replace(" alternate","").split(" "),d="top"==i[i.length-1]&&i.pop(),l="-child"==i[i.length-1].substr(-6)?i.pop():d,p=r.parent().find("tr."+l),c=p.filter(":last"),u=p.not(r),f=i.slice(0,-1),g=f[f.length-1]?f[f.length-1]:d,b=r.parent().find("tr[rel="+g+"]")}function o(n){e(n);var o,r=p.find("input[name^=position]"),a=!1;r.each(function(n,e){t(e).val(n+1)}),a=r.serialize(),o=b.size()?b.find("button.collapsing").parent().addClass("updating"):n.find("button.collapsing").parent().addClass("updating"),t.ajax({url:updates_url+"&action=shopp_category_order",timeout:7e3,type:"POST",datatype:"text",data:a,success:function(){o.removeClass("updating")},error:function(t,n){o.removeClass("updating"),alert(SAVE_ERROR+" ("+n+")")}})}if(!t(this).is("tr"))return!1;if(!t(this).parent().is("tbody"))return!1;var r,a,s,i,d,l,p,c,u,f,g,b,h,m=t(this);m.dragRelatedRows({onDrop:o}),m.find("button[name=top]").hover(function(){t(this).toggleClass("hover")}).click(function(){return e(t(this)),1!=h&&(r.parent().find("tr."+s).not(r).remove(),r.find("button.collapsing").addClass("closed").css("background-position","-180px top"),b.size()?r.insertAfter(b):r.insertBefore(r.parent().find("tr:first")),void o(r))}),m.find("button[name=bottom]").hover(function(){t(this).toggleClass("hover")}).click(function(){return e(t(this)),h!=p.size()&&(r.find("button.collapsing").addClass("closed").css("background-position","-180px top"),r.parent().find("tr."+s).not(r).remove(),r.insertAfter(c),void o(r))}),m.find("button.collapsing").click(function(n){function o(){f+=c,d.css("background-position",f+"px top"),f<0?setTimeout(o,20):d.trigger("closed")}function i(){f-=c,d.css("background-position",f+"px top"),Math.abs(f)<g?setTimeout(i,20):d.trigger("opened")}var d=t(this),l=!1,p=!1,c=20,f=new Number(d.css("background-position").replace("%","").replace("px","").split(" ").shift()),g=180;return e(d),d.hasClass("closed")?(openedButton=u.find("button.collapsing:not(button.closed)"),opened=openedButton.parent().parent(),opened.size()>0&&(l=opened.attr("rel"),p=opened.parent().find("tr."+l).not("tr[rel="+l+"]").remove(),u.find("button.collapsing:not(button.closed)"),openedButton.addClass("closed").css("background-position","-180px top")),d.bind("closed",function(){d.removeClass("closed")}),cell.addClass("updating"),t.ajax({url:loadchildren_url+"&action=shopp_category_children&parent="+a,timeout:5e3,dataType:"json",success:function(n){cell.removeClass("updating"),0==n.length?d.remove():n instanceof Object?t.each(n,function(){new ProductCategory(this,r)}):d.addClass("closed").css("background-position","-180px top")},error:function(t,n){cell.removeClass("updating"),d.addClass("closed").css("background-position","-180px top"),alert(LOAD_ERROR+" ("+n+")")}}),setTimeout(o,20)):(d.bind("opened",function(){r.parent().find("tr."+s).not(r).fadeOut("fast").remove(),d.addClass("closed")}),setTimeout(i,20))}).hover(function(){t(this).toggleClass("hover")}).css("background-position","-180px top"),String.prototype.repeat=function(t){var n="",e=1;for(e=1;e<t;e++)n+=this;return n}},t("#arrange-categories tbody tr").arrangeRow()});