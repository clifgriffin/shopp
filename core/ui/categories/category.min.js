var Pricelines=new Pricelines,productOptions=new Array,optionMenus=new Array,detailsidx=1,variationsidx=1,optionsidx=1,pricingidx=1,pricelevelsidx=1,fileUploader=!1,changes=!1,saving=!1,flashUploader=!1,template=!0;jQuery(document).ready(function(){function e(e){var t=i("#pricerange-menu"),n=pricelevelsidx++,a=new NestedMenu(n,t,"priceranges","",e,!1,{axis:"y",scroll:!1});i(a.label).change(function(){this.value=asMoney(this.value)}).change()}function t(e){var t=i("#details-menu"),n=i("#details-list"),a=i("#addDetailOption"),s=detailsidx,o=new NestedMenu(s,t,"specs",NEW_DETAIL_DEFAULT,e,{target:n,type:"list"});o.items=new Array,o.addOption=function(e){var t=new NestedMenuOption(o.index,o.itemsElement,o.dataname,NEW_OPTION_DEFAULT,e,!0);o.items.push(t)};var c=i('<li class="setting"></li>').appendTo(o.itemsElement),l=i('<select name="specs['+o.index+'][facetedmenu]"></select>').appendTo(c);i('<option value="disabled">'+FACETED_DISABLED+"</option>").appendTo(l),i('<option value="auto">'+FACETED_AUTO+"</option>").appendTo(l),i('<option value="ranges">'+FACETED_RANGES+"</option>").appendTo(l),i('<option value="custom">'+FACETED_CUSTOM+"</option>").appendTo(l),e&&e.facetedmenu&&l.val(e.facetedmenu),l.change(function(){"disabled"==i(this).val()||"auto"==i(this).val()?(i(a).hide(),i(o.itemsElement).find("li.option").hide()):(i(a).show(),i(o.itemsElement).find("li.option").show())}).change(),e&&e.options&&i.each(e.options,function(e,t){o.addOption(t)}),i(o.itemsElement).sortable({axis:"y",items:"li.option",scroll:!1}),o.element.unbind("click",o.click),o.element.click(function(){o.selected(),i(a).unbind("click").click(o.addOption),i(l).change()}),detailsidx++}var i=jQuery;new SlugEditor(category,"category"),new ImageUploads(i("#image-category-id").val(),"category");titlePrompt=i("#title-prompt-text"),title=i("#title").bind("focus keydown",function(){titlePrompt.hide()}).blur(function(){""==title.val()?titlePrompt.show():titlePrompt.hide()}),postboxes.add_postbox_toggles("shopp_page_shopp-categories"),i(".if-js-closed").removeClass("if-js-closed").addClass("closed"),i(".postbox a.help").click(function(){return i(this).colorbox({iframe:!0,open:!0,innerWidth:768,innerHeight:480,scrolling:!1}),!1}),i("#workflow").change(function(){setting=i(this).val(),request.page=adminpage,request.id=category,request.id||(request.id="new"),"new"==setting&&(request.id="new",request.next=setting),"close"==setting&&delete request.id,"previous"==setting&&i.each(worklist,function(e,t){t.id==category&&(worklist[e-1]?request.next=worklist[e-1].id:delete request.id)}),"next"==setting&&i.each(worklist,function(e,t){t.id==category&&(worklist[e+1]?request.next=worklist[e+1].id:delete request.id)})}).change(),i("#category").submit(function(){return""==title.val()?(alert(ENTER_CATEGORY_NAME),!1):(this.action=this.action.substr(0,this.action.indexOf("?"))+"?"+i.param(request),!0)}),i("#templates, #details-template, #details-facetedmenu, #variations-template, #variations-pricing, #price-ranges").hide(),i("#spectemplates-setting").change(function(){this.checked?i("#templates, #details-template").show():i("#details-template").hide(),i("#spectemplates-setting").attr("checked")||i("#variations-setting").attr("checked")||i("#templates").hide()}).change(),i("#faceted-setting").change(function(){this.checked?(i("#details-menu").removeClass("options").addClass("menu"),i("#details-facetedmenu, #price-ranges").show()):(i("#details-menu").removeClass("menu").addClass("options"),i("#details-facetedmenu, #price-ranges").hide())}).change(),details&&i.each(details,function(e,i){t(i)}),i("#addPriceLevel").click(function(){e()}),i("#addDetail").click(function(){t()}),i("#variations-setting").bind("toggleui",function(){this.checked?i("#templates, #variations-template, #variations-pricing").show():i("#variations-template, #variations-pricing").hide(),i("#spectemplates-setting").attr("checked")||i("#variations-setting").attr("checked")||i("#templates").hide()}).click(function(){i(this).trigger("toggleui")}).trigger("toggleui"),options&&loadVariations(options.v?options.v:options,prices),i("#addVariationMenu").click(function(){addVariationOptionsMenu()}),i("#pricerange-facetedmenu").change(function(){"custom"==i(this).val()?i("#pricerange-menu, #addPriceLevel").show():i("#pricerange-menu, #addPriceLevel").hide()}).change(),priceranges&&i.each(priceranges,function(t,i){e(i)}),category||i("#title").focus()});