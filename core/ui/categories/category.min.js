var Pricelines=new Pricelines,productOptions=new Array,optionMenus=new Array,detailsidx=1,variationsidx=1,optionsidx=1,pricingidx=1,pricelevelsidx=1,fileUploader=!1,changes=!1,saving=!1,flashUploader=!1,template=!0;jQuery(document).ready(function(){function e(e){var t=n("#pricerange-menu"),i=pricelevelsidx++,a=new NestedMenu(i,t,"priceranges","",e,!1,{axis:"y",scroll:!1});n(a.label).change(function(){this.value=asMoney(this.value)}).change()}function t(e){var t=n("#details-menu"),i=n("#details-list"),a=n("#addDetailOption"),s=detailsidx,o=new NestedMenu(s,t,"specs",NEW_DETAIL_DEFAULT,e,{target:i,type:"list"});o.items=new Array,o.addOption=function(e){var t=new NestedMenuOption(o.index,o.itemsElement,o.dataname,NEW_OPTION_DEFAULT,e,!0);o.items.push(t)};var c=n('<li class="setting"></li>').appendTo(o.itemsElement),l=n('<select name="specs['+o.index+'][facetedmenu]"></select>').appendTo(c);n('<option value="disabled">'+FACETED_DISABLED+"</option>").appendTo(l),n('<option value="auto">'+FACETED_AUTO+"</option>").appendTo(l),n('<option value="ranges">'+FACETED_RANGES+"</option>").appendTo(l),n('<option value="custom">'+FACETED_CUSTOM+"</option>").appendTo(l),e&&e.facetedmenu&&l.val(e.facetedmenu),l.change(function(){"disabled"==n(this).val()||"auto"==n(this).val()?(n(a).hide(),n(o.itemsElement).find("li.option").hide()):(n(a).show(),n(o.itemsElement).find("li.option").show())}).change(),e&&e.options&&n.each(e.options,function(e,t){o.addOption(t)}),n(o.itemsElement).sortable({axis:"y",items:"li.option",scroll:!1}),o.element.unbind("click",o.click),o.element.click(function(){o.selected(),n(a).unbind("click").click(o.addOption),n(l).change()}),detailsidx++}function i(){n("#workflow").change(function(){setting=n(this).val(),request.page=adminpage,request.id=category,request.id||(request.id="new"),"new"==setting&&(request.id="new",request.next=setting),"close"==setting&&delete request.id,"previous"==setting&&n.each(worklist,function(e,t){t.id==category&&(worklist[e-1]?request.next=worklist[e-1].id:delete request.id)}),"next"==setting&&n.each(worklist,function(e,t){t.id==category&&(worklist[e+1]?request.next=worklist[e+1].id:delete request.id)})}).change()}var n=jQuery;new SlugEditor(category,"category"),new ImageUploads(n("#image-category-id").val(),"category");titlePrompt=n("#title-prompt-text"),title=n("#title").bind("focus keydown",function(){titlePrompt.hide()}).blur(function(){""==title.val()?titlePrompt.show():titlePrompt.hide()}),postboxes.add_postbox_toggles("shopp_page_shopp-categories"),n(".if-js-closed").removeClass("if-js-closed").addClass("closed"),n(".postbox a.help").click(function(){return n(this).colorbox({iframe:!0,open:!0,innerWidth:768,innerHeight:480,scrolling:!1}),!1}),i(),n("#category").submit(function(){return""==title.val()?(alert(ENTER_CATEGORY_NAME),!1):(this.action=this.action.substr(0,this.action.indexOf("?"))+"?"+n.param(request),!0)}),n("#templates, #details-template, #details-facetedmenu, #variations-template, #variations-pricing, #price-ranges").hide(),n("#spectemplates-setting").change(function(){this.checked?n("#templates, #details-template").show():n("#details-template").hide(),n("#spectemplates-setting").attr("checked")||n("#variations-setting").attr("checked")||n("#templates").hide()}).change(),n("#faceted-setting").change(function(){this.checked?(n("#details-menu").removeClass("options").addClass("menu"),n("#details-facetedmenu, #price-ranges").show()):(n("#details-menu").removeClass("menu").addClass("options"),n("#details-facetedmenu, #price-ranges").hide())}).change(),details&&n.each(details,function(e,i){t(i)}),n("#addPriceLevel").click(function(){e()}),n("#addDetail").click(function(){t()}),n("#variations-setting").bind("toggleui",function(){this.checked?n("#templates, #variations-template, #variations-pricing").show():n("#variations-template, #variations-pricing").hide(),n("#spectemplates-setting").attr("checked")||n("#variations-setting").attr("checked")||n("#templates").hide()}).click(function(){n(this).trigger("toggleui")}).trigger("toggleui"),options&&loadVariations(options.v?options.v:options,prices),n("#addVariationMenu").click(function(){addVariationOptionsMenu()}),n("#pricerange-facetedmenu").change(function(){"custom"==n(this).val()?n("#pricerange-menu, #addPriceLevel").show():n("#pricerange-menu, #addPriceLevel").hide()}).change(),priceranges&&n.each(priceranges,function(t,i){e(i)}),category||n("#title").focus()});