function categories(){var e=jQuery;e("#product .category-metabox").each(function(){var i=e(this),t=e(this).attr("id").split("-").slice(1).join("-"),n=i.find("div.new-category").hide(),a=i.find("ul.category-tabs");a.find("li a").click(function(i){i.preventDefault();var t=e(this),a=t.attr("href");t.parent().addClass("tabs").siblings("li").removeClass("tabs"),e(a).show().siblings("div.tabs-panel").hide(),t.parent().hasClass("new-category")?n.slideDown("fast",function(){n.find("input").focus()}):n.hide()});e("#"+t+"-checklist").wpList({alt:"",response:t+"-ajax-response",addBefore:function(i){return!!e("#new-"+t+"-name").val()&&(i.data+="&"+e(":checked","#"+t+"-checklist").serialize(),e("#"+t+"-add-submit").prop("disabled",!0),i)},addAfter:function(i,n){var a,o=e("#new"+t+"_parent");e("#"+t+"-add-submit").prop("disabled",!1),"undefined"!=n.parsed.responses[0]&&(a=n.parsed.responses[0].supplemental.newcat_parent)&&(o.before(a),o.remove())}}),a.find("li.tabs a").click(),e("#"+t+"-checklist li.popular-category :checkbox, #"+t+"-checklist-pop :checkbox").on("click",function(){var i=e(this),n=i.is(":checked"),a=i.val();a&&i.parents("#taxonomy-"+t).length&&e("#in-"+t+"-"+a+", #in-popular-"+t+"-"+a).attr("checked",n)})}),e(".category-metabox input[type=checkbox]").change(function(){if(!this.checked)return!0;var i,t=new Array;e("#details-menu").children().children().find("input.label").each(function(i,n){t.push(e(n).val())}),i=e(this).val(),e.getJSON(spectemp_url+"&action=shopp_spec_template&category="+i,function(e){if(!e)return!0;for(i in e)e[i].add=!0,-1==t.toString().search(e[i].name)&&addDetail(e[i])}),e.getJSON(opttemp_url+"&action=shopp_options_template&category="+i,function(i){if(!(i&&i.options&&i.prices&&(Object.keys(i.options).length>0||Object.keys(i.prices).length>0)))return!0;var t=e("#variations-setting"),n=i.options.v?i.options.v:i.options,a=!1;t.attr("checked")||t.attr("checked",!0).trigger("toggleui"),optionMenus.length>0?e.each(n,function(i,t){t&&t.name&&t.options&&((menu=optionMenuExists(t.name))?(a=!1,e.each(t.options,function(e,i){i&&i.name&&(optionMenuItemExists(menu,i.name)||(menu.addOption(i),a=!0))}),a&&addVariationPrices()):(delete t.id,e.each(t.options,function(e,i){i&&i.name&&delete i.id}),addVariationOptionsMenu(t)))}):loadVariations(n,i.prices)})})}function tags(){var e=jQuery;e("#product .tags-metabox").each(function(){var i=e(this),t=e(this).attr("id").split("-").slice(1).join("-"),n=i.find(".tags"),a=n.val().split(","),o=new SearchSelector({source:t,parent:i,url:tagsugg_url,fieldname:"tax_input["+t+"]",label:TAG_SEARCHSELECT_LABEL,classname:"tags",freeform:!0,autosuggest:"shopp_popular_tags"});n.val(""),e.each(a,function(e,i){0!=i.length&&o.ui.prepend(o.newItem("",i))})})}var Pricelines=new Pricelines,productOptions=new Array,productAddons=new Array,optionMenus=new Array,addonGroups=new Array,addonOptionsGroup=new Array,selectedMenuOption=!1,detailsidx=1,variationsidx=1,addon_group_idx=1,addonsidx=1,optionsidx=1,pricingidx=1,fileUploader=!1,changes=!1,saving=!1,template=!1,fileUploads=!1,changesMade=!1,isSave=!1;jQuery(document).ready(function(e){var i=e("#title"),t=e("#title-prompt-text"),n=e(".publishdate");i.bind("focus keydown",function(){t.hide()}).blur(function(){""==i.val()?t.show():t.hide()}),product||(i.focus(),t.show()),postboxes.add_postbox_toggles(screenid),e(".if-js-closed").removeClass("if-js-closed").addClass("closed"),e(".postbox a.help").click(function(){return e(this).colorbox({iframe:!0,open:!0,innerWidth:768,innerHeight:480,scrolling:!1}),!1}),e('<div id="publish-calendar" class="calendar"></div>').appendTo("#wpwrap").PopupCalendar({m_input:e("#publish-month"),d_input:e("#publish-date"),y_input:e("#publish-year"),autoinit:!0,title:calendarTitle,startWeek:startWeekday}),e("#schedule-toggle").click(function(){e("#scheduling").slideToggle("fast",function(){e(this).is(":visible")?n.removeAttr("disabled"):n.attr("disabled",!0)})}),e("#scheduling").hide(),n.attr("disabled",!0),e("#published").change(function(){e(this).prop("checked")?e("#publish-status,#schedule-toggling").show():e("#publish-status,#schedule-toggling,#scheduling").hide()}).change(),e("#process-time").change(function(){var i=e("#processing");e(this).prop("checked")?i.slideDown("fast"):i.hide()}).change(),editslug=new SlugEditor(product,"product"),specs&&e.each(specs,function(){addDetail(this)}),e("#addDetail").click(function(){addDetail()}),fileUploads=new FileUploader("#filechooser"),basePrice=e(prices).get(0),basePrice&&"product"==basePrice.context?Pricelines.add(!1,basePrice,"#product-pricing"):Pricelines.add(!1,!1,"#product-pricing"),e("#variations-setting").bind("toggleui",variationsToggle).click(function(){e(this).trigger("toggleui")}).trigger("toggleui"),loadVariations(options&&(options.v||options.a)?options.v:options,prices),e("#addVariationMenu").click(function(){addVariationOptionsMenu()}),e("#linkOptionVariations").click(linkVariationsButton).change(linkVariationsButtonLabel),e("#addons-setting").bind("toggleui",addonsToggle).click(function(){e(this).trigger("toggleui")}).trigger("toggleui"),e("#newAddonGroup").click(function(){newAddonGroup()}),options&&options.a&&loadAddons(options.a,prices),imageUploads=new ImageUploads(e("#image-product-id").val(),"product"),categories(),tags(),quickSelects(),e("#product").change(function(){changes=!0}).unbind("submit").submit(function(t){if(t.stopPropagation(),""==i.val())return alert(ENTER_PRODUCT_NAME),!1;var n=e("#product").attr("action").split("?")[0]+"?"+e.param(request);return e("#product")[0].setAttribute("action",n),saving=!0,!0}),e("#prices-loading").remove(),e("input").on("change",function(){changesMade=!0,e(this).off("change")}),e("input[name='save']").click(function(){isSave=!0}),window.onbeforeunload=function(){var e="undefined"!=typeof tinymce&&tinymce.activeEditor;if(!isSave&&(changesMade||e&&e.isDirty()&&!e.isHidden()))return $msg.confirm}});