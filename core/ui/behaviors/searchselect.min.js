function SearchSelector(e){var t=jQuery,a=this,n=(t(this),{source:"shopp_tags",parent:"",url:ajaxurl,action:"shopp_suggestions",fieldname:"input[]",label:"Begin typing to search&hellip;",classname:"",freeform:!1,autosuggest:!1,autodelay:3e3}),e=t.extend(n,e),s=t('<ul class="search-select"><li><input type="text" name="entry" class="input" /></li></ul>'),l=s.find("input.input").focus(function(){s.find("li.selected").removeClass("selected"),t(document).unbind("keydown").keydown(a.keyhandler)});return a.ui=s,a.stopEvent=function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1},a.keyhandler=function(n){var o=l.val();if(/8$|9$|13$|46$|37$|39$/.test(n.keyCode)){var c,i=s.find("li.item.selected");if(t(n.target).hasClass("input"))switch(c=l.parent().prev(),n.keyCode){case 9:case 13:a.stopEvent(n),e.freeform&&o.length>0&&(s.append(a.newItem("",o)),l.val("").parent().appendTo(s),l.focus());break;case 188:e.freeform&&o.length>0&&(a.stopEvent(n),s.append(a.newItem("",o)),l.val("").parent().appendTo(s),l.focus());case 37:case 8:case 46:if(l.val().length>0)break;if(a.stopEvent(n),!c.length)break;l.blur(),c.click()}else if(i.length)switch(a.stopEvent(n),n.keyCode){case 8:case 46:i.fadeRemove("fast",function(){l.focus()});break;case 37:i.prev("li.item").click();break;case 39:i.next("li").click()}}},a.newItem=function(n,s){var l=t('<li class="item"><input type="hidden" name="'+e.fieldname+"["+n+']" value="'+s+'" />'+s+'<a href="#" class="remove"></a></li>').hoverClass().click(function(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,l.parent().find("li.item.selected").removeClass("selected"),t(this).addClass("selected"),t(document).unbind("keydown").keydown(a.keyhandler)});return l.find("a.remove").click(function(){l.fadeRemove("fast")}),l},a.selection=function(){var e=t(this),n=e.val(),s=e.attr("alt"),l=e.parent(),o=l.parent();o.append(a.newItem(s,n)),l.appendTo(o),e.val("").attr("alt","").focus()},s.appendTo(e.parent).click(function(){l.focus()}).suggest(e.url+"&action="+e.action+"&s="+e.source,{delay:300,minchars:2,format:"json",showOnFocus:!0,autoSelect:!0,autoDelay:e.autodelay,autoSuggest:e.autosuggest,label:e.label,resultsClass:"search-select-results"+(e.classname?" "+e.classname:""),onSelect:this.selection}),this}