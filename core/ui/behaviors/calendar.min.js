jQuery.fn.PopupCalendar=function(e){var t=jQuery,n=this,a=t(this),s={month:(new Date).getMonth()+1,year:(new Date).getFullYear(),selection:!1,m_input:!1,d_input:!1,y_input:!1,input:!1,startWeek:0,title:"my",scheduling:!0,scheduleAfter:!1,disabled:"disabled",scopeMonth:"month",active:"active",selected:"selected",hover:"hover",autoinit:!1},e=t.extend(s,e),l=new Array(new Array(0,31,28,31,30,31,30,31,31,30,31,30,31),new Array(0,31,29,31,30,31,30,31,31,30,31,30,31)),i=new Array("",$cal.jan,$cal.feb,$cal.mar,$cal.apr,$cal.may,$cal.jun,$cal.jul,$cal.aug,$cal.sep,$cal.oct,$cal.nov,$cal.dec),c=new Array($cal.sun,$cal.mon,$cal.tue,$cal.wed,$cal.thu,$cal.fri,$cal.sat),o=639787,r=11,u=42,d=4,p=6,h=new Array(30,31,1,2,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1),(-1)),f=new Date,g=new Array,v=new Array,y=(e.month,e.year,e.m_input),w=e.d_input,m=e.y_input,D=y?y:e.input,T=y?y.add(w).add(m):D,A=e.startWeek,M=e.title,$=e.autoinit,C=e.disabled,Y=e.scopeMonth,k=e.active,b=e.selected,F=e.hover;return f=new Date(f.getFullYear(),f.getMonth(),f.getDate()),n.scope=Y,n.scheduling=e.scheduling,n.selection=e.selection?e.selection:f,n.ui=!1,a.mouseenter(function(){n.ui=!0}).mouseleave(function(){n.ui=!1}),n.change(function(){return D!==!1&&D.val(n.selection.getMonth()+1+"/"+n.selection.getDate()+"/"+n.selection.getFullYear()),y!==!1&&y.val(n.selection.getMonth()+1),w!==!1&&w.val(n.selection.getDate()),m!==!1&&m.val(n.selection.getFullYear()),n.focused&&n.focused.select(),this}),n.bind("updated",function(){var e=!1;y!==!1&&""!=y.val()&&""!=w.val()&&""!=m.val()?n.select(new Date(m.val(),y.val()-1,w.val())):D!==!1&&(e=D.val().match(/^(\d{1,2}).{1}(\d{1,2}).{1}(\d{4})/),e&&n.select(new Date(e[3],e[1]-1,e[2])))}),n.select=function(e){e&&(e instanceof Date?n.selection=e:n.selection=new Date(e)),n.change().render(n.selection.getMonth()+1,n.selection.getFullYear()).autoselect()},n.render=function(s,l){a.empty();var o,r,u,d,p,h,y,w,m=0,D=0,T=0,$=!1,_=new Array,S=new Array;for(s||(s=n.selection.getMonth()+1),l||(l=n.selection.getFullYear()),v=this.getDayMap(s,l,A,!0),e.scheduleAfter.selection&&($=e.scheduleAfter.selection),e.scheduleAfter===!1&&($=f),o=t('<span class="back">&#9664;</span>').appendTo(a),r=new Date(l,s-1,0),(!n.scheduling||n.scheduling&&r.getTime()>=$.getTime())&&o.click(function(){n.scope=Y,n.selection=new Date(l,s-2),n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.change()}),u=t('<span class="next">&#9654;</span>').click(function(){n.scope=Y,n.selection=new Date(l,s),n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.change()}).appendTo(a),d=t("<h3></h3>").appendTo(a),m=0;m<M.length;m++)-1!=t.inArray(M[m],["m","n","M","F"])&&t('<span class="month">'+i[s]+"</span>").appendTo(d),-1!=t.inArray(M[m],["y","Y"])&&t('<span class="year">'+l.toString()+"</span>").appendTo(d),t("<span> </span>").appendTo(d);for(S[D]=t('<div class="week"></week>').appendTo(a),T=A,m=0;m<7;m++)p=c[T],_[m]=t('<div class="label">'+p.substr(0,3)+"</span>").appendTo(S[D]),T++,T>=c.length&&(T=0);for(m=0;m<v.length;m++){var h=v[m].getMonth()+1,y=v[m].getFullYear(),w=new Date(y,h-1,v[m].getDate());m%7==0&&(S[++D]=t('<div class="week"></div>').appendTo(a)),v[m]!=-1&&(g[m]=t('<div title="'+m+'">'+w.getDate()+"</div>").appendTo(S[D]),g[m].date=w,h!=s&&g[m].addClass(C),n.scheduling&&w.getTime()<$.getTime()&&g[m].addClass(C),w.getTime()==f.getTime()&&g[m].addClass("today"),g[m].hover(function(){t(this).addClass(F)},function(){t(this).removeClass(F)}),g[m].mousedown(function(){t(this).addClass(k)}),g[m].mouseup(function(){t(this).removeClass(k)}),(!n.scheduling||n.scheduling&&w.getTime()>=$.getTime())&&g[m].click(function(){n.resetCalendar(),t(this).hasClass(C)||t(this).addClass(b),n.select(v[t(this).attr("title")]),n.scope="day",n.selection.getMonth()+1!=s?(n.render(n.selection.getMonth()+1,n.selection.getFullYear()),n.autoselect()):(n.ui=!1,a.hide()),n.change().trigger("calendarSelect")}))}return this},n.autoselect=function(){for(var e=0;e<v.length;e++)if(v[e].getTime()==n.selection.getTime())return g[e].addClass(b)},n.resetCalendar=function(){for(var e=0;e<g.length;e++)g[e].removeClass(b)},n.getDayMap=function(e,t,a,s){var i,c,o,r,d,p,f=1,g=0,v=new Array,y=e-1==0?12:e-1,w=12==y?t-1:t;if(9==e&&1752==t)return h;for(i=0;i<u;i++)v.push(-1);if(c=l[n.is_leapyear(w)?1:0][y],o=l[n.is_leapyear(t)?1:0][e],r=n.dayInWeek(1,e,t,a),d=n.dayInWeek(1,e,t,a),s)for(;d--;)v[d]=new Date(w,y-1,(c--));for(;o--;)v[r++]=new Date(t,e-1,(f++));if(p=v.length-r,s)for(;g<p;)v[r++]=new Date(t,e,(++g));return v},n.dayInYear=function(e,t,a){var s,i=n.is_leapyear(a)?1:0;for(s=1;s<t;s++)e+=l[i][s];return e},n.dayInWeek=function(e,t,a,s){var l=365*(a-1)+n.leapYearsSinceBC(a-1)+n.dayInYear(e,t,a),i=d;return l<o&&(i=(l-1+p)%7),l>=o+r&&(i=(l-1+p-r)%7),i<=s?i+=7-s:i-=s},n.is_leapyear=function(e){return e<=1752?!(e%4):!(e%4)&&e%100>0||!(e%400)},n.centuriesSince1700=function(e){return e>1700?Math.floor(e/100)-17:0},n.quadCenturiesSince1700=function(e){return e>1600?Math.floor((e-1600)/400):0},n.leapYearsSinceBC=function(e){return Math.floor(e/4)-n.centuriesSince1700(e)+n.quadCenturiesSince1700(e)},D!==!1&&D.length>0&&(pos=D.offset(),pad=t("#wpadminbar").size()>0?t("#wpadminbar").height()*-1:0,pos.left+pos.top==0&&(pos=D.parent().parent().css("display","block").offset(),pad=6),a.css({left:pos.left+"px",top:pos.top+D.outerHeight(!0)+"px"}),y!==!1&&m.val()+y.val()+w.val()!=""&&(n.selection=new Date(m.val(),y.val()-1,w.val())),T.focus(function(e){var s=t(this).offset();a.css({left:s.left+"px",top:s.top+"px"}),n.show(),n.focused=t(this)}).click(function(){n.focused&&n.focused.focus().select()}).blur(function(e){n.ui?t(this).focus().select():n.hide()}).bind("change.input",function(){n.trigger("updated")}).trigger("change.input")),e.scheduleAfter.selection&&e.scheduleAfter.change(function(){n.render().autoselect()}),$&&n.change(),n.render().autoselect(),this};