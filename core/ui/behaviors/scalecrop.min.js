jQuery.fn.scaleCrop=function(t){var i=jQuery,e={imgsrc:!1,target:{width:300,height:300},init:{x:!1,y:!1,s:!1}},t=i.extend(e,t),o=t.target.width+100,h=t.target.height+100,s=maskBottom=(h-t.target.height)/2,a=maskRight=(o-t.target.width)/2,n=t.target.width,p=t.target.height,d=maxHeight=aspect=0,g="px",l=" solid",r=g+l+" white",c=g+l+" black",f={x:0,y:0,s:100},w=i(this),u=(w.parent().parent().parent().css({width:o+22+g}),i('<div class="scalecrop"/>').css({position:"relative",overflow:"hidden",width:o+g,height:h+g}).appendTo(w)),m=i('<img src="'+t.imgsrc+'" />').appendTo(u),x=(i("<div/>").css({width:t.target.width+g,height:t.target.height+g,border:s+1+r,opacity:.8}).appendTo(u),i("<div/>").css({top:s+g,left:a+g,width:t.target.width+g,height:t.target.height+g,border:"1"+c}).appendTo(u)),y=i("<div/>").appendTo(u),v=function(t){var i=(d-n)*t+n,e=(maxHeight-p)*t+p,o=aspect<1?e/maxHeight:i/d,h=x.position(),s=(m.position(),{width:m.width(),height:m.height()}),a=b.data("draggable"),l=!1;aspect<1?m.width(d*o).height(e):m.width(i).height(maxHeight*o),m[0].style.left=m.position().left+Math.ceil((s.width-m.width())/2)+g,m[0].style.top=m.position().top+Math.ceil((s.height-m.height())/2)+g,l=m.position(),l.left>h.left&&(m[0].style.left=h.left+1+g,l=m.position()),l.top>h.top&&(m[0].style.top=h.top+1+g,l=m.position()),l.left+m.width()<h.left+x.width()+1&&(m[0].style.left=h.left+x.width()-m.width()+1+g,l=m.position()),l.top+m.height()<h.top+x.height()+1&&(m[0].style.top=h.top+x.height()-m.height()+1+g,l=m.position()),a&&a.element.css({left:l.left,top:l.top}),y.width(2*m.width()-x.width()).height(2*m.height()-x.height()).css({left:h.left+(x.width()-y.width())/2+1+g,top:h.top+(x.height()-y.height())/2+1+g}),b.draggable("option","containment",y),f={x:l.left-h.left-1,y:l.top-h.top-1,s:o},w.trigger("change.scalecrop",[f])},b=i("<div/>").css({width:"100%",height:"100%",cursor:"move"}).draggable({helper:function(){return m.get(0)},start:function(t,i){i.position=i.offset},stop:function(t,e){var o=i(this).data("draggable");o.cancelHelperRemoval=!0,o.element.css({left:e.position.left,top:e.position.top}),f.x=m.position().left-x.position().left-1,f.y=m.position().top-x.position().top-1,w.trigger("change.scalecrop",[f])}}).appendTo(u),H=i('<div class="slidebar"/>').css({left:(o-176)/2+g}).appendTo(u);return scaler=i('<div class="slideball"/>').unbind().mousedown(function(){scaler.css({backgroundPosition:"left -16px"}),i(document).mouseup(function(){scaler.css({backgroundPosition:"left top"})})}).draggable({axis:"x",containment:"parent",drag:function(t,e){var o=H.width()-i(this).width(),h=e.position.left/o;v(h)}}).appendTo(H),m.hide().load(function(){d=this.width,maxHeight=this.height,aspect=d/maxHeight,b.width(d).height(maxHeight);var i=t.init.x!==!1?t.init.x+g:x.position().left+(x.outerWidth()-m.width())/2+g,e=t.init.y!==!1?t.init.y+g:x.position().top+(x.outerHeight()-m.height())/2+g,o=t.init.s!==!1?t.init.s:0;v(o),inst=b.data("draggable"),m.css({left:i,top:e}).fadeIn("fast"),v(o),0!=o&&(scaler.get(0).style.left=(H.width()-scaler.width())*o+g),w.trigger("ready.scalecrop",[f])}),w};