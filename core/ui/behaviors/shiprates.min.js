jQuery(document).ready(function(e){quickSelects(),e("#selectall").change(function(){e(this).attr("checked")?e("#carriers input").not(this).attr("checked",!0):e("#carriers input").not(this).attr("checked",!1)}),e("#flatrates-editor").size()>0&&(e.each(shipping,function(t,n){e.template(n+"-editor",e("#"+n+"-editor"))}),e.template("delivery-menu",e("#delivery-menu")),e.template("flatrates-editor",e("#flatrates-editor")),e.template("flatrate-row",e("#flatrate-row")),e.template("tablerates-editor",e("#tablerates-editor")),e.template("tablerate-row",e("#tablerate-row")),e.template("tablerate-row-tier",e("#tablerate-row-tier")),e.template("location-fields",e("#location-fields")));var t=!1,n=e("#shipping-option-menu"),a=e("#no-shiprate-settings"),o=function(t){t.postcode||(t.postcode="*");var n=e.tmpl("location-fields",t),a=n.find("select"),o=n.find("input.postcode"),i=function(e,t){return'<option value="'+e+'">'+t+"</option>"},l=function(e,t){var n=a.val().split(","),l="",u=[],c=[],s=" &#x25be;",d="&sdot;&sdot;&sdot;&nbsp;",f={region:"*",country:"",area:"",zone:""},p=0,h=!1;t&&(n=t.split(","));for(key in f)n[p]&&(f[key]=n[p]),p++;console.log(f);for(p in lookup.regions)if(p==f.region&&lookup.regionmap[p]){l+=i(p,lookup.regions[p]+s),c=lookup.regionmap[p];for(r in c)if(country=c[r],countryname=lookup.countries[country],country==f.country)if(h=lookup.postcodes[country],lookup.areas[country]){l+=i(p+","+country,countryname+s),areas=lookup.areas[country];for(area in areas)if(area==f.area){zones=lookup.areas[country][area],l+=i(p+","+country+","+area,area+s),l+='<optgroup label="'+area+'">';for(zoneid in zones)zone=zones[zoneid],l+=i(p+","+country+","+area+","+zone,lookup.zones[country][zone]+", "+country.substr(0,2));l+="</optgroup>"}else l+=i(p+","+country+","+area,"&nbsp;&nbsp;"+area)}else if(lookup.zones[country]){l+=i(p+","+country,countryname+s),l+='<optgroup label="'+countryname+'">',zones=lookup.zones[country];for(zone in zones)l+=i(p+","+country+","+zone,zones[zone]+", "+country.substr(0,2));l+="</optgroup>"}else l+=i(p+","+country,countryname);else l+=i(p+","+country,d+countryname)}else l+=i(p,lookup.regions[p]);for(key in f)""!=f[key]&&u.push(f[key]);a.empty().html(l).val(u.join(",")),h&&o.attr("disabled",!1)};return a.change(l),l(!1,t.destination),n},i=function(t,n){if(t&&n){var a=[],i=[],r=!1,l=t.parents("table.shopp-settings").find("button.addrate");n.table&&(i=n.table),n.module&&(r=n.module),n.norates&&t.find("th.rate").remove(),t.row=function(i,l){i&&i.preventDefault(),l||(l={}),l.module=r,l.row=a.length;var u=e.tmpl("flatrate-row",l),c=(u.find("input.money").each(function(){this.value=asMoney(new Number(this.value))}).change(function(){this.value=asMoney(this.value)}).mouseup(function(){e(this).select()}),new o(l)),s=u.find("button.delete").click(function(e){e.preventDefault(),u.fadeRemove()});n.norates&&u.find("td.rate").remove(),a.push(u),a.length>1&&u.hover(function(){s.fadeIn("fast")},function(){s.hide()}),c.prependTo(u),u.appendTo(t.find("tbody"))},l.click(t.row),0==i.length?t.row(!1):e.each(i,function(e,n){t.row(!1,n)})}},l=function(t,n){if(t&&n){var a=[],i=[],r=!1,l=t.parents("table.shopp-settings").find("button.addrate");n.table&&(i=n.table),n.module&&(r=n.module),t.row=function(i,l,u){var c=[];i&&i.preventDefault(),u||(u={}),u.module=r,u.row=l?l:a.length,n.unit?(u.unit=n.unit[0]?n.unit[0]:"?",u.unitabbr=n.unit[1]?n.unit[1]:$s.c):(u.unit="?",u.unitabbr="?");var s=e.tmpl("tablerate-row",u),d=u.row,f=s.find("table.panel"),p=new o(u),h=s.find("button.delete").click(function(e){e.preventDefault(),s.fadeRemove()});p.insertBefore(s.find("td:first")),a.push(s),a.length>1&&s.hover(function(){h.fadeIn("fast")},function(){h.hide()}),s.addtier=function(t,a){t&&t.preventDefault(),a||(a={threshold:1,rate:1}),a.module=r,a.row=d,a.tier=c.length,a.unitabbr="",a.threshold_class=n.threshold_class,a.rate_class=n.rate_class,n.unit&&n.unit[1]&&(a.unitabbr=n.unit[1]);var o=e.tmpl("tablerate-row-tier",a),i=(o.find("input").mouseup(function(){e(this).select()}),o.find("button.add").click(s.addtier),o.find("button.delete").click(function(e){e.preventDefault(),o.fadeRemove()}));o.find("input.money").each(function(){this.value=asMoney(this.value.match(/[^(\d,\. )]/)?asNumber(this.value):new Number(this.value))}).change(function(){this.value=asMoney(this.value)}),o.find("input.percentage").each(function(){this.value=asPercent(this.value.match(/[^(\d,\. )]/)?asNumber(this.value):new Number(this.value))}).change(function(){this.value=asPercent(this.value)}).change(),c.push(o),c.length>1?o.hover(function(){i.fadeIn("fast")},function(){i.hide()}):i.css("opacity",0).removeClass("hidden").unbind("click").click(function(e){e.preventDefault()}),o.appendTo(f)},u.tiers?e.each(u.tiers,function(e,t){s.addtier(!1,t)}):s.addtier(),s.appendTo(t)},l.click(t.row),0==i.length?t.row(!1,0):e.each(i,function(e,n){t.row(!1,e,n)})}},u=function(o){o.preventDefault();var r=!1;t&&t.cancel(!1),a.hide();var u=e(this),c=e.getQueryVar("id",u.attr("href")),s=n.val()?n.val().toLowerCase():c,d=settings[s]?settings[s]:defaults[s]?defaults[s]:{},f=u.parents("tr").hide(),p=f.size()>0&&f.attr("id").substr(10),h=d.type?d.type:p?p:s,m=e.tmpl(h+"-editor",d);cancel=m.find("a.cancel"),fb=m.find("input.fallback").attr("checked","on"==d.fallback&&"checked"),maxd=m.find("select.maxdelivery").html(e.tmpl("delivery-menu")).val(d.maxdelivery),mind=m.find("select.mindelivery").html(e.tmpl("delivery-menu")).val(d.mindelivery).change(function(){var t=e(this),n=t.attr("selectedIndex"),a=maxd.attr("selectedIndex");maxd.find("option").attr("disabled",!1).each(function(t,a){t<n&&e(a).attr("disabled","disabled")}),a<n&&maxd.attr("selectedIndex",n)}),selectall=m.find("input.selectall-toggle").change(function(t){var n=e(this),a=n.parents("ul").find("input");a.attr("checked",n.attr("checked"))}),ratetable=m.find("table.rate-table-shipping").size()>0,n.get(0).selectedIndex=0,u.cancel=function(e){e&&e.preventDefault(),t=!1,m.remove(),f.fadeIn("fast"),a.size()>0&&a.show()},cancel.click(u.cancel),ratetable&&(r=m.find("table.flatrates"),r.size()>0&&i(r,d),r=m.find("table.tablerates"),r.size()>0&&l(r,d)),console.log(m),f.size()>0?m.insertAfter(f):m.prependTo("#the-list"),t=u};e("#the-list a.edit").click(u),n.change(u),e("#the-list a.delete").click(function(){return!!confirm($ps.confirm)})});