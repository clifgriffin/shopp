function NestedMenu(e,i,t,n,a,l,o){var r=jQuery,s=this;o||(o={axis:"y"}),s.items=l,s.dataname=t,s.index=e,s.element=r('<li><div class="move"></div><input type="hidden" name="'+t.replace("[","-").replace("]","-")+'-sortorder[]" value="'+e+'" class="sortorder" /><input type="hidden" name="'+t+"["+e+'][id]" class="id" /><input type="text" name="'+t+"["+e+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(r(i).children("ul")),s.moveHandle=s.element.find("div.move"),s.sortorder=s.element.find("input.sortorder"),s.id=s.element.find("input.id"),s.label=s.element.find("input.label"),s.deleteButton=s.element.find("button.delete").bind("delete",function(){var e=r(i).find("input.deletes");""!=r(s.id).val()&&e.val(""==e.val()?r(s.id).val():e.val()+","+r(s.id).val()),l&&s.itemsElement.remove(),s.element.remove()}).click(function(){r(this).trigger("delete")}),s.items&&("list"==l.type?s.itemsElement=r("<ul></ul>").appendTo(l.target).hide():s.itemsElement=r("<li></li>").appendTo(l.target).hide()),s.selected=function(){r(i).find("ul li").removeClass("selected"),r(s.element).addClass("selected"),l&&(r(l.target).children().hide(),r(s.itemsElement).show())},s.element.click(this.selected).hover(function(){r(this).addClass("hover")},function(){r(this).removeClass("hover")}),s.label.mouseup(function(e){this.select()}).focus(function(){r(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&r(this).blur().unbind("keydown")})}),s.id.val(s.index),a&&a.id&&s.id.val(a.id),a&&a.name?s.label.val(htmlentities(a.name)):s.label.val(n+" "+s.index),r(i).children("ul").hasClass("ui-sortable")?r(i).children("ul").sortable("refresh"):r(i).children("ul").sortable(o)}function NestedMenuContent(e,i,t,n){var a=jQuery;this.contents=a('<textarea name="'+t+"["+e+'][value]" cols="40" rows="7"></textarea>').appendTo(i),n&&n.value&&this.contents.val(htmlentities(n.value))}function NestedMenuOption(e,i,t,n,a){var l=jQuery,o=this;o.index=l(i).contents().length,o.element=l('<li class="option"><div class="move"></div><input type="hidden" name="'+t+"["+e+"][options]["+this.index+'][id]" class="id" /><input type="text" name="'+t+"["+e+"][options]["+this.index+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(i),o.moveHandle=o.element.find("div.move"),o.id=o.element.find("input.id"),o.label=o.element.find("input.label"),o.deleteButton=o.element.find("button.delete").click(function(){l(o.element).remove()}),o.element.hover(function(){l(this).addClass("hover")},function(){l(this).removeClass("hover")}),o.label.click(function(){this.select()}).focus(function(){l(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&l(this).blur().unbind("keydown")})}),o.id.val(o.index),a.id&&o.id.val(a.id),a.name&&o.label.val(htmlentities(a.name)),a.name||o.label.val(n+" "+(o.index+1))}function loadVariations(e,i){if(e){var t=jQuery;t.each(e,function(e,i){i&&i.id&&addVariationOptionsMenu(i)}),t.each(i,function(e,i){"variation"==i.context&&Pricelines.add(i.options.split(","),i,"#variations-pricing")}),Pricelines.updateVariationsUI(),t.each(e,function(e,i){i&&i.options&&t.each(i.options,function(e,i){i&&i.id&&"on"==i.linked&&Pricelines.linkVariations(i.id)})})}}function addVariationOptionsMenu(e){var i=jQuery,t=i("#variations-menu"),n=i("#variations-list"),a=(i("#addVariationMenu"),i("#addVariationOption")),l=i("#linkOptionVariations"),o=variationsidx,r=new NestedMenu(o,t,"meta[options][v]",OPTION_MENU_DEFAULT,e,{target:n,type:"list"},{axis:"y",update:function(){orderOptions(t,n)}});r.addOption=function(e){var t,o,s=!1;e||(e=new Object),e.id?e.id>optionsidx&&(optionsidx=e.id):(s=!0,e.id=optionsidx),t=new NestedMenuOption(r.index,r.itemsElement,"meta[options][v]",NEW_OPTION_DEFAULT,e),optionsidx++,o=t.id.val(),t.linkIcon=i('<span class="shoppui-link"></span>').appendTo(t.moveHandle),t.linked=i('<input type="hidden" name="meta[options][v]['+r.index+"][options]["+t.index+'][linked]" class="linked" />').val(e.linked?e.linked:"off").appendTo(t.element).change(function(){"on"==i(this).val()?t.linkIcon.removeClass("hidden"):t.linkIcon.addClass("hidden")}).change(),t.selected=function(){t.element.hasClass("selected")?(n.find("ul li").removeClass("selected"),selectedMenuOption=!1):(n.find("ul li").removeClass("selected"),i(t.element).addClass("selected"),selectedMenuOption=t),l.change()},t.element.click(t.selected),productOptions[o]=t.label,t.label.blur(function(){updateVariationLabels()}),t.deleteButton.unbind("click"),t.deleteButton.click(function(){1==r.itemsElement.children().length?deleteVariationPrices([o],!0):deleteVariationPrices([o]),t.element.remove()}),s?addVariationPrices():addVariationPrices(o),n.dequeue().animate({scrollTop:n.prop("scrollHeight")-n.height()},200),t.label.click().focus().select().keydown(function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),t.label.blur(),a.focus())}),r.items.push(t)},r.items=new Array,e&&e.options?i.each(e.options,function(){r.addOption(this)}):(r.addOption(),r.addOption()),r.itemsElement.sortable({axis:"y",update:function(){orderVariationPrices()}}),r.element.unbind("click",r.click).click(function(){r.selected(),i(a).unbind("click").click(r.addOption)}),optionMenus[variationsidx++]=r,r.deleteButton.unbind("click").click(function(){var e=new Array;i(r.itemsElement).find("li").not(".ui-sortable-helper").find("input.id").each(function(t,n){e.push(i(n).val())}),deleteVariationPrices(e,!0),i(this).trigger("delete")}),e||(n.dequeue().animate({scrollTop:n.attr("scrollHeight")-n.height()},200),r.label.click().focus().select().keydown(function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),a.focus())}))}function buildVariations(){var e,i,t,n,a=jQuery,l=new Array,o=a("#variations-list ul"),r=o.length,s=r-1,d=new Array(o.length),c=new Array(o.length),u=0;for(o.each(function(e,i){c[e]=a(i).children().length,0==u?u=a(i).children().length:u*=a(i).children().length,d[e]=0}),e=0;e<u;e++){for(i=0;i<o.length;i++)t=a(o[i]).children("li").not(".ui-sortable-helper").children("input.id"),l[e]?l[e].push(a(t[d[i]]).val()):l[e]=[a(t[d[i]]).val()];if(++d[s]>=c[s])for(n=s;n>-1;n--)d[n]<c[n]||(d[n]=0,n-1>-1&&d[n-1]++)}return l}function addVariationPrices(e){if(!e){var i,t,n=jQuery,a=buildVariations(),l=n("#variations-pricing"),o=n(l).children(),r=!1;n(a).each(function(e,n){i=xorkey(n),t=xorkey(n.slice(0,n.length-1)),""==t&&(t=-1),Pricelines.row[i]||(Pricelines.row[t]?(Pricelines.row[i]=Pricelines.row[t],delete Pricelines.row[t],Pricelines.row[i].setOptions(n)):(0==o.length?Pricelines.add(n,{context:"variation"},"#variations-pricing"):Pricelines.add(n,{context:"variation"},Pricelines.row[xorkey(a[e-1])].row,"after"),r=!0))}),r&&Pricelines.updateVariationsUI()}}function deleteVariationPrices(e,i){var t,n,a,l,o,r=jQuery,s=buildVariations(),d=!1;r(s).each(function(s,c){for(n=xorkey(c),t=0;t<e.length;t++)c.indexOf(e[t])!=-1&&(a=new Array,r(c).each(function(i,n){n!=e[t]&&a.push(n)}),l=xorkey(a),i&&!Pricelines.row[l]?(0!=l?Pricelines.row[l]=Pricelines.row[n]:Pricelines.row[n].row.remove(),delete Pricelines.row[n],Pricelines.row[l]&&(Pricelines.row[l].setOptions(a),d=!0)):Pricelines.row[n]&&(o=r("#priceid-"+Pricelines.row[n].id).val(),""==r("#deletePrices").val()?r("#deletePrices").val(o):r("#deletePrices").val(r("#deletePrices").val()+","+o),Pricelines.remove(n)))}),d&&Pricelines.updateVariationsUI()}function optionMenuExists(e){if(!e)return!1;var i=jQuery,t=!1;return i.each(optionMenus,function(n,a){if(a&&i(a.label).val()==e)return t=n}),optionMenus[t]?optionMenus[t]:t}function optionMenuItemExists(e,i){if(!e||!e.items||!i)return!1;var t=jQuery,n=!1;return t.each(e.items,function(e,a){if(a&&t(a.label).val()==i)return n=!0}),n}function updateVariationLabels(){var e=jQuery,i=buildVariations();e(i).each(function(e,i){var t=xorkey(i);Pricelines.row[t]&&Pricelines.row[t].updateLabel()})}function orderOptions(e,i){var t=jQuery;t(e).find("ul li").not(".ui-sortable-helper").find("input.id").each(function(e,n){n&&t(optionMenus[t(n).val()].itemsElement).appendTo(i)}),orderVariationPrices()}function orderVariationPrices(){var e,i=jQuery,t=buildVariations();i(t).each(function(i,t){e=xorkey(t),e>0&&Pricelines.row[e]&&Pricelines.reorderVariation(e,t)}),Pricelines.updateVariationsUI("tabs")}function xorkey(e){e instanceof Array||(e=[e]);for(var i=0,t=0;t<e.length;t++)i^=7001*e[t];return i}function variationsToggle(){var e=jQuery,i=e(this),t=e("#variations"),n=e("#product-pricing");i.prop("checked")?(Pricelines.row[0]&&Pricelines.row[0].disable(),n.hide(),t.show()):(t.hide(),n.show(),Pricelines.row[0]&&Pricelines.row[0].enable())}function addonsToggle(){var e=jQuery,i=e(this),t=e("#addons");i.prop("checked")?t.show():t.hide()}function clearLinkedIcons(){jQuery("#variations-list input.linked").val("off").change()}function linkVariationsButton(){var e=jQuery;selectedMenuOption?"off"==selectedMenuOption.linked.val()?(Pricelines.allLinked()&&(clearLinkedIcons(),Pricelines.unlinkAll()),selectedMenuOption.linked.val("on").change(),Pricelines.linkVariations(selectedMenuOption.id.val())):(selectedMenuOption.linked.val("off").change(),Pricelines.unlinkVariations(selectedMenuOption.id.val())):(clearLinkedIcons(),Pricelines.allLinked()?Pricelines.unlinkAll():Pricelines.linkAll()),e(this).change()}function linkVariationsButtonLabel(){var e=jQuery;selectedMenuOption?"on"==selectedMenuOption.linked.val()?e(this).find("small").html(" "+UNLINK_VARIATIONS):e(this).find("small").html(" "+LINK_VARIATIONS):Pricelines.allLinked()?e(this).find("small").html(" "+UNLINK_ALL_VARIATIONS):e(this).find("small").html(" "+LINK_ALL_VARIATIONS)}function loadAddons(e,i){var t=jQuery;e&&(t.each(e,function(e,i){newAddonGroup(i)}),t.each(i,function(e,i){if("addon"==i.context){var t=addonOptionsGroup[i.options];Pricelines.add(i.options,this,"#addon-pricegroup-"+t)}}),Pricelines.updateVariationsUI())}function newAddonGroup(e){var i=jQuery,t=i("#addon-menu"),n=i("#addon-list"),a=i("#newAddonGroup"),l=i("#addAddonOption"),o=addon_group_idx,r=new NestedMenu(o,t,"meta[options][a]",ADDON_GROUP_DEFAULT,e,{target:n,type:"list"},{axis:"y",update:function(){orderAddonGroups()}});r.itemsElement.attr("id","addon-group-"+o),r.pricegroup=i('<div id="addon-pricegroup-'+o+'" />').appendTo("#addon-pricing"),r.pricegroupLabel=i("<label />").html("<h4>"+r.label.val()+"</h4>").prependTo(r.pricegroup),r.updatePriceLabel=function(){r.pricegroupLabel.html("<h4>"+r.label.val()+"</h4>")},r.label.blur(r.updatePriceLabel),r.addOption=function(e){var t,a,o=!1;e||(e=new Object),e.id?e.id>addonsidx&&(addonsidx=e.id):(o=!0,e.id=addonsidx),t=new NestedMenuOption(r.index,r.itemsElement,"meta[options][a]",NEW_OPTION_DEFAULT,e),addonsidx++,a=t.id.val(),t.selected=function(){t.element.hasClass("selected")?(n.find("ul li").removeClass("selected"),selectedMenuOption=!1):(n.find("ul li").removeClass("selected"),i(t.element).addClass("selected"),selectedMenuOption=t)},t.element.click(t.selected),productAddons[a]=t.label,t.label.blur(function(){Pricelines.row[a].updateLabel()}),t.deleteButton.unbind("click"),t.deleteButton.click(function(){var e=Pricelines.row[a].data.id,n=i("#deletePrices");e&&(""==n.val()?n.val(e):n.val(n.val()+","+e)),Pricelines.row[a].row.remove(),t.element.remove()}),o&&Pricelines.add(a,{context:"addon"},r.pricegroup),addonOptionsGroup[a]=r.index,r.items.push(t),n.dequeue().animate({scrollTop:n.attr("scrollHeight")-n.height()},200),t.label.click().focus().select().keydown(function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),t.label.blur(),l.focus())})},r.items=new Array,e&&e.options?i.each(e.options,function(){r.addOption(this)}):(r.addOption(),r.addOption()),r.itemsElement.sortable({axis:"y",update:function(){orderAddonPrices(r.index)}}),r.element.unbind("click",r.click),r.element.click(function(){r.selected(),i(l).unbind("click").click(r.addOption)}),addonGroups[addon_group_idx++]=r,r.deleteButton.unbind("click").click(function(){i("#addon-list #addon-group-"+r.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,t){var n,a=i(t).val(),l=i("#deletePrices");Pricelines.row[a]&&(n=Pricelines.row[a].data.id,n&&(""==l.val()?l.val(n):l.val(l.val()+","+n)),Pricelines.row[a].row.remove())}),r.deleteButton.trigger("delete"),r.pricegroup.remove(),r.element.remove()}),e||(t.dequeue().animate({scrollTop:t.attr("scrollHeight")-t.height()},200),r.label.click().focus().select().keydown(function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),r.label.blur(),a.focus())}))}function orderAddonGroups(){var e,i=jQuery;i("#addon-menu ul li").not(".ui-sortable-helper").find("input.id").each(function(t,n){e=addonGroups[i(n).val()],e.pricegroup.appendTo("#addon-pricing")})}function orderAddonPrices(e){var i=jQuery,t=addonGroups[e];i("#addon-list #addon-group-"+t.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,n){Pricelines.reorderAddon(i(n).val(),t.pricegroup)})}function readableFileSize(e){var i=new Array("bytes","KB","MB","GB"),t=1*e,n=0;if(0==t)return t;for(;t>1e3;)t/=1024,n++;return t.toFixed(2)+" "+i[n]}function addDetail(e){var i,t,n=jQuery,a=n("#details-menu"),l=n("#details-list"),o=detailsidx++,r=new NestedMenu(o,a,"details","Detail Name",e,{target:l});if(e&&e.options){t=n('<select name="details['+r.index+'][value]"></select>').appendTo(r.itemsElement),n("<option></option>").appendTo(t);for(i in e.options)n("<option>"+e.options[i].name+"</option>").appendTo(t);e&&e.value&&t.val(htmlentities(e.value))}else r.item=new NestedMenuContent(r.index,r.itemsElement,"details",e);e&&!e.add||(r.add=n('<input type="hidden" name="details['+r.index+'][new]" value="true" />').appendTo(r.element),a.dequeue().animate({scrollTop:a.attr("scrollHeight")-a.height()},200),r.label.click().focus().select(),r.item&&r.item.contents.keydown(function(e){var i=e.keyCode||e.which;9==i&&(e.preventDefault(),n("#addDetail").focus())}))}function ImageUploads(e,i){function t(){p("#browser-uploader").hide(),u.loaded=!0}function n(){p("#lightbox li").size()>0&&p("#lightbox").sortable({opacity:.8})}function a(e,i,t){return i==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED?void alert("You selected too many files to upload at one time. "+(0===t?"You have reached the upload limit.":"You may upload "+(t>1?"up to "+t+" files.":"only one file."))):void alert(t)}function l(e,i){try{this.startUpload()}catch(t){this.debug(t)}}function o(e){this.targetHolder=p('<li class="image uploading"><input type="hidden" name="images[]" /><div class="progress"><div class="bar"></div><div class="gloss"></div></div></li>').appendTo(p("#lightbox")),this.progressBar=this.targetHolder.find("div.bar"),this.sorting=this.targetHolder.find("input")}function r(e,i,t){this.progressBar.animate({width:Math.ceil(i/t*76)+"px"},100)}function s(e,i,t){}function d(e,i){var t,a,l=!1,o=this.targetHolder;try{l=p.parseJSON(i)}catch(r){return o.remove(),alert(i),!1}return l.id?(o.attr({id:"image-"+l.id}),this.sorting.val(l.id),t=p('<img src="?siid='+l.id+'" width="96" height="96" class="handle" />').appendTo(o).hide(),a=p('<button type="button" name="deleteImage" value="'+l.id+'" class="delete"><span class="shoppui-minus"></span></button>').appendTo(o).hide(),n(),void this.progressBar.animate({width:"76px"},250,function(){p(this).parent().fadeOut(500,function(){p(this).remove(),p(t).fadeIn("500"),c(a)})})):(o.remove(),l.error?alert(l.error):alert(UNKNOWN_UPLOAD_ERROR),!0)}function c(e){e.hide(),e.parent().hover(function(){e.show()},function(){e.hide()}),e.click(function(){if(confirm(DELETE_IMAGE_WARNING)){var i="<"==e.val().substr(0,1)?e.find("input[name=ieisstupid]").val():e.val(),t=p("#deleteImages"),n=t.val();t.val(""==n?i:n+","+i),p("#confirm-delete-images").show(),e.parent().fadeOut(500,function(){p(this).remove()})}})}var u,p=jQuery,h={button_text:ADD_IMAGE_BUTTON_TEXT,button_text_style:'.buttonText{text-align:center;font-family:"Lucida Grande","Lucida Sans Unicode",Tahoma,Verdana,_sans;font-size:9px;color:#333333;}',button_text_top_padding:3,button_height:"22",button_width:"100",button_image_url:uidir+"/icons/buttons.png",button_placeholder_id:"swf-uploader-button",upload_url:ajaxurl,flash_url:uidir+"/behaviors/swfupload/swfupload.swf",file_queue_limit:0,file_size_limit:filesizeLimit+"b",file_types:"*.jpg;*.jpeg;*.png;*.gif",file_types_description:"Web-compatible Image Files",file_upload_limit:filesizeLimit,post_params:{action:"shopp_upload_image",parent:e,type:i},swfupload_loaded_handler:t,file_queue_error_handler:a,file_dialog_complete_handler:l,upload_start_handler:o,upload_progress_handler:r,upload_error_handler:s,upload_success_handler:d,custom_settings:{loaded:!1,targetHolder:!1,progressBar:!1,sorting:!1},prevent_swf_caching:p.ua.msie,debug:imageupload_debug};flashuploader&&(u=new SWFUpload(h)),p("#image-upload").upload({name:"Filedata",action:ajaxurl,params:{action:"shopp_upload_image",type:i},onSubmit:function(){this.targetHolder=p('<li id="image-uploading"><input type="hidden" name="images[]" value="" /><div class="progress"><div class="bar"></div><div class="gloss"></div></div></li>').appendTo("#lightbox"),this.progressBar=this.targetHolder.find("div.bar"),this.sorting=this.targetHolder.find("input")},onComplete:function(e){var i,t,n=!1,a=this.targetHolder;try{n=p.parseJSON(e)}catch(l){n.error=e}return n&&n.id?(a.attr({id:"image-"+n.id}),this.sorting.val(n.id),i=p('<img src="?siid='+n.id+'" width="96" height="96" class="handle" />').appendTo(a).hide(),t=p('<button type="button" name="deleteImage" value="'+n.src+'" class="delete"><span class="shoppui-minus"></span></button>').appendTo(p(a)).hide(),void p(this.progressBar).animate({width:"76px"},250,function(){p(this).parent().fadeOut(500,function(){p(this).remove(),p(i).fadeIn("500"),c(t)})})):(a.remove(),n.error?alert(n.error):alert(UNKNOWN_UPLOAD_ERROR),!1)}}),p(document).load(function(){u.loaded||p("#product-images .swfupload").remove()}),n(),p("#lightbox li").each(function(){p(this).dblclick(function(){var e=p(this).attr("id")+"-details",i=p("#"+e),t=i.find("input[type=hidden]").val(),n=i.find("img"),a=i.find("input.imagetitle"),l=i.find("input.imagealt"),o=i.find("input.imagecropped"),r=p('<div class="image-details-editor"><div class="details-editor"><img class="thumb" width="96" height="96" /><div class="details"><p><label>'+IMAGE_DETAILS_TITLE_LABEL+': </label><input type="text" name="title" /></p><p><label>'+IMAGE_DETAILS_ALT_LABEL+': </label><input type="text" name="alt" /></p></div></div><div class="cropping"><p class="clear">'+IMAGE_DETAILS_CROP_LABEL+': <select name="cropimage"><option></option></select></p><div class="cropui"></div><br class="clear"/></div><input type="button" class="button-primary alignright" value="&nbsp;&nbsp;'+IMAGE_DETAILS_DONE+'&nbsp;&nbsp;" /></div>'),s=(r.find("img").attr("src",n.attr("src")),r.find("input[name=title]").val(a.val()).change(function(){a.val(s.val())})),d=r.find("input[name=alt]").val(l.val()).change(function(){l.val(d.val())}),c=(r.find("input[type=button]").click(function(){p.colorbox.close()}),r.find("div.cropping").hide()),u=r.find("div.cropui"),h=r.find("select[name=cropimage]").change(function(){if(""==h.val())return u.empty(),void p.colorbox.resize();var e=h.val().split(":"),i=o.filter("input[alt="+h.val()+"]").val().split(",");u.empty().scaleCrop({imgsrc:"?siid="+t,target:{width:parseInt(e[0],10),height:parseInt(e[1],10)},init:{x:parseInt(i[0],10),y:parseInt(i[1],10),s:new Number(i[2])}}).ready(function(){var i=125;p.colorbox.resize({innerWidth:parseInt(e[0],10)+i})}).bind("change.scalecrop",function(e,i){i.s||(i.s=1),i&&o.filter("input[alt="+h.val()+"]").val(i.x+","+i.y+","+i.s)})});o.size()>0&&(o.each(function(e,i){var t=p(i).attr("alt");p('<option value="'+t+'">'+(e+1)+": "+t.replace(":","&times;")+"</option>").appendTo(h)}),c.show()),p.colorbox({title:IMAGE_DETAILS_TEXT,html:r})}),c(p(this).find("button.delete"))})}function FileUploader(e,i){function t(){s(i).hide(),this.loaded=!0}function n(e,i,t){return i==SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED?void alert("You selected too many files to upload at one time. "+(0===t?"You have reached the upload limit.":"You may upload "+(t>1?"up to "+t+" files.":"only one file."))):void alert(t)}function a(e,i){if(s.colorbox.hide(),e)try{this.startUpload()}catch(t){this.debug(t)}}function l(e){this.targetCell.attr("class","").html(""),s('<div class="progress"><div class="bar"></div><div class="gloss"></div></div>').appendTo(this.targetCell),this.progressBar=this.targetCell.find("div.bar")}function o(e,i,t){this.progressBar.animate({width:Math.ceil(i/t*76)+"px"},100)}function r(e,i){var t=!1,n=this.targetCell,a=this.targetLine;s.colorbox.close();try{t=s.parseJSON(i)}catch(l){t.error=i}return t.id||t.name?(t.type=t.type.replace(/\//gi," "),void s(this.progressBar).animate({width:"76px"},250,function(){s(this).parent().fadeOut(500,function(){s(this).remove(),s(n).attr("class","file").html('<div class="icon shoppui-file '+t.type+'"></div>'+t.name+"<br /><small>"+readableFileSize(t.size)+'</small><input type="hidden" name="price['+a+'][download]" value="'+t.id+'" />')})})):(n.html(NO_DOWNLOAD),t.error?alert(t.error):alert(UNKNOWN_UPLOAD_ERROR),!1)}var s=jQuery,d=this;d.swfu=!1,d.settings={button_text:'<span class="button">'+UPLOAD_FILE_BUTTON_TEXT+"</span>",button_text_style:'.button { text-align: center; font-family:"Lucida Grande","Lucida Sans Unicode",Tahoma,Verdana,sans-serif; font-size: 9px; color: #333333; }',button_text_top_padding:3,button_height:"22",button_width:"100",button_image_url:uidir+"/icons/buttons.png",button_placeholder_id:e,button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE,flash_url:uidir+"/behaviors/swfupload/swfupload.swf",upload_url:ajaxurl,file_queue_limit:1,file_size_limit:filesizeLimit+"b",file_types:"*.*",file_types_description:"All Files",file_upload_limit:filesizeLimit,post_params:{action:"shopp_upload_file"},swfupload_loaded_handler:t,file_queue_error_handler:n,file_dialog_complete_handler:a,upload_start_handler:l,upload_progress_handler:o,upload_success_handler:r,custom_settings:{loaded:!1,targetCell:!1,targetLine:!1,progressBar:!1},prevent_swf_caching:s.ua.msie,debug:fileupload_debug},flashuploader&&(d.swfu=new SWFUpload(d.settings)),i.upload({name:"Filedata",action:ajaxurl,params:{action:"shopp_upload_file"},onSubmit:function(){s.colorbox.hide(),d.targetCell.attr("class","").html(""),s('<div class="progress"><div class="bar"></div><div class="gloss"></div></div>').appendTo(d.targetCell),d.progressBar=d.targetCell.find("div.bar")},onComplete:function(e){s.colorbox.close();var i=!1,t=d.targetCell;try{i=s.parseJSON(e)}catch(n){i.error=e}return i.id||i.name?(i.type=i.type.replace(/\//gi," "),void s(d.progressBar).animate({width:"76px"},250,function(){s(this).parent().fadeOut(500,function(){t.attr("class","file").html('<div class="icon shoppui-file '+i.type+'"></div>'+i.name+"<br /><small>"+readableFileSize(i.size)+'</small><input type="hidden" name="price['+d.targetLine+'][download]" value="'+i.id+'" />'),s(this).remove()})})):(t.html(NO_DOWNLOAD),i.error?alert(i.error):alert(UNKNOWN_UPLOAD_ERROR),!1)}}),s(d).load(function(){d.swfu&&d.swfu.loaded||s(i).parent().parent().find(".swfupload").remove()}),d.updateLine=function(e,i){d.swfu?(d.swfu.targetLine=e,d.swfu.targetCell=i):(d.targetLine=e,d.targetCell=i)}}function SlugEditor(e,i){var t=jQuery,n=this,a=t("#edit-slug-buttons"),l=a.find(".edit"),o=a.find(".view"),r=t("#editor-slug-buttons"),s=r.find(".save"),d=r.find(".cancel"),c=t("#editable-slug-full");n.permalink=function(){var n,l=0,u=t("#editable-slug"),p=u.html(),h=t("#slug_input"),f=h.html(),m=c.html();for(a.hide(),r.show(),s.unbind("click").click(function(){var n=u.children("input").val(),l=t("#title").val();t.post(editslug_url+"&action=shopp_edit_slug",{id:e,type:i,slug:n,title:l},function(e){u.html(p),e!=-1&&(u.html(e),c.html(e),h.val(e)),o.attr("href",canonurl+c.html()),r.hide(),a.show()},"text")}),d.unbind("click").click(function(){u.html(p),r.hide(),a.show(),h.attr("value",f)}),n=0;n<m.length;++n)"%"==m.charAt(n)&&l++;slug_value=l>m.length/4?"":m,u.html('<input type="text" id="new-post-slug" value="'+slug_value+'" />').children("input").keypress(function(e){var i=e.which;13!=i&&27!=i||e.preventDefault(),13==i&&s.click(),27==i&&d.click(),h.val(this.value)}).focus()},l.click(n.permalink)}jQuery.fn.FileChooser=function(e,i){var t=jQuery,n=this,a=t("#chooser"),l=a.find(".fileimport"),o=a.find(".status"),r=t("#attach-file"),s=t("#download_path-"+e),d=t("#download_file-"+e),c=t("#file-"+e),u=!1,p=0;n.line=e,n.status=i,a.unbind("change").on("change",".fileimport",function(e){o.attr("class","status").addClass("shoppui-spinner shoppui-spinfx shoppui-spinfx-steps8"),t.ajax({url:fileverify_url+"&action=shopp_verify_file&t=download",type:"POST",data:"url="+l.val(),timeout:1e4,dataType:"text",success:function(e){return o.attr("class","status"),"OK"==e?o.addClass("shoppui-ok-sign"):("NULL"==e&&o.attr("title",FILE_NOT_FOUND_TEXT),"ISDIR"==e&&o.attr("title",FILE_ISDIR_TEXT),"READ"==e&&o.attr("title",FILE_NOT_READ_TEXT),void o.addClass("shoppui-warning-sign"))}})}),l.unbind("keydown").unbind("keypress").suggest(sugg_url+"&action=shopp_storage_suggestions&t=download",{delay:500,minchars:3,multiple:!1,onSelect:function(){l.trigger("change")}}),t(this).click(function(){fileUploads.updateLine(e,i),o.attr("class","status"),r.unbind("click").click(function(){if(t.colorbox.hide(),u)return s.val(l.val()),l.val("").attr("class","fileimport"),!0;var i=!1,n=l.val(),a=function(e){return e.name?(c.attr("class","file").html('<span class="icon shoppui-file '+e.mime.replace("/"," ")+'"></span>'+e.name+"<br /><small>"+readableFileSize(e.size)+"</small>"),s.val(e.path),d.val(e.name),void l.val("").attr("class","fileimport")):$this.attr("class","")},o=function(){var n=c.find("div.progress"),l=n.find("div.bar"),r=n.outerWidth(),s=t("#import-file-"+e).get(0).contentWindow,d=s.importProgress,u=s.importFile;if(void 0!==u){if(u.error)return c.attr("class","error").html("<small>"+u.error+"</small>");if(!u.path)return c.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>");if(u.stored)return a(u);savepath=u.path.split("/"),i=savepath[savepath.length-1]}return d||(d=0),0===d&&p++>60?c.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>"):(l.animate({width:Math.ceil(d*r)+"px"},100),1==d?void(l&&l.css({width:"100%"}).fadeOut(500,function(){a(u)})):void setTimeout(o,100))};setTimeout(o,100),c.attr("class","").html('<div class="progress"><div class="bar"></div><div class="gloss"></div></div><iframe id="import-file-'+e+'" width="0" height="0" src="'+fileimport_url+"&action=shopp_import_file&url="+n+'"></iframe>')})}),t(this).colorbox({title:"File Selector",innerWidth:"360",innerHeight:"140",inline:!0,href:a})};