function NestedMenu(e,i,n,t,l,o,a){var r=jQuery,s=this;a||(a={axis:"y"}),s.items=o,s.dataname=n,s.index=e,s.element=r('<li><div class="move"></div><input type="hidden" name="'+n.replace("[","-").replace("]","-")+'-sortorder[]" value="'+e+'" class="sortorder" /><input type="hidden" name="'+n+"["+e+'][id]" class="id" /><input type="text" name="'+n+"["+e+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(r(i).children("ul")),s.moveHandle=s.element.find("div.move"),s.sortorder=s.element.find("input.sortorder"),s.id=s.element.find("input.id"),s.label=s.element.find("input.label"),s.deleteButton=s.element.find("button.delete").bind("delete",function(){var e=r(i).find("input.deletes");""!=r(s.id).val()&&e.val(""==e.val()?r(s.id).val():e.val()+","+r(s.id).val()),o&&s.itemsElement.remove(),s.element.remove()}).click(function(){r(this).trigger("delete")}),s.items&&("list"==o.type?s.itemsElement=r("<ul></ul>").appendTo(o.target).hide():s.itemsElement=r("<li></li>").appendTo(o.target).hide()),s.selected=function(){r(i).find("ul li").removeClass("selected"),r(s.element).addClass("selected"),o&&(r(o.target).children().hide(),r(s.itemsElement).show())},s.element.click(this.selected).hover(function(){r(this).addClass("hover")},function(){r(this).removeClass("hover")}),s.label.mouseup(function(e){this.select()}).focus(function(){r(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&r(this).blur().unbind("keydown")})}),s.id.val(s.index),l&&l.id&&s.id.val(l.id),l&&l.name?s.label.val(htmlentities(l.name)):s.label.val(t+" "+s.index),r(i).children("ul").hasClass("ui-sortable")?r(i).children("ul").sortable("refresh"):r(i).children("ul").sortable(a)}function NestedMenuContent(e,i,n,t){var l=jQuery;this.contents=l('<textarea name="'+n+"["+e+'][value]" cols="40" rows="7"></textarea>').appendTo(i),t&&t.value&&this.contents.val(htmlentities(t.value))}function NestedMenuOption(e,i,n,t,l){var o=jQuery,a=this;a.index=o(i).contents().length,a.element=o('<li class="option"><div class="move"></div><input type="hidden" name="'+n+"["+e+"][options]["+this.index+'][id]" class="id" /><input type="text" name="'+n+"["+e+"][options]["+this.index+'][name]" class="label" /><button type="button" class="delete"><span class="shoppui-minus"></span></button></li>').appendTo(i),a.moveHandle=a.element.find("div.move"),a.id=a.element.find("input.id"),a.label=a.element.find("input.label"),a.deleteButton=a.element.find("button.delete").click(function(){o(a.element).remove()}),a.element.hover(function(){o(this).addClass("hover")},function(){o(this).removeClass("hover")}),a.label.click(function(){this.select()}).focus(function(){o(this).keydown(function(e){e.stopPropagation(),13==e.keyCode&&o(this).blur().unbind("keydown")})}),a.id.val(a.index),l.id&&a.id.val(l.id),l.name&&a.label.val(htmlentities(l.name)),l.name||a.label.val(t+" "+(a.index+1))}function loadVariations(e,i){if(e){var n=jQuery;n.each(e,function(e,i){i&&i.id&&addVariationOptionsMenu(i)}),n.each(i,function(e,i){"variation"==i.context&&Pricelines.add(i.options.split(","),i,"#variations-pricing")}),Pricelines.updateVariationsUI(),n.each(e,function(e,i){i&&i.options&&n.each(i.options,function(e,i){i&&i.id&&"on"==i.linked&&Pricelines.linkVariations(i.id)})})}}function addVariationOptionsMenu(e){var i=jQuery,n=i("#variations-menu"),t=i("#variations-list"),l=(i("#addVariationMenu"),i("#addVariationOption")),o=i("#linkOptionVariations"),a=new NestedMenu(variationsidx,n,"meta[options][v]",OPTION_MENU_DEFAULT,e,{target:t,type:"list"},{axis:"y",update:function(){orderOptions(n,t)}});a.addOption=function(e){var n,r,s=!1;e||(e=new Object),e.id?e.id>optionsidx&&(optionsidx=e.id):(s=!0,e.id=optionsidx),n=new NestedMenuOption(a.index,a.itemsElement,"meta[options][v]",NEW_OPTION_DEFAULT,e),optionsidx++,r=n.id.val(),n.linkIcon=i('<span class="shoppui-link"></span>').appendTo(n.moveHandle),n.linked=i('<input type="hidden" name="meta[options][v]['+a.index+"][options]["+n.index+'][linked]" class="linked" />').val(e.linked?e.linked:"off").appendTo(n.element).change(function(){"on"==i(this).val()?n.linkIcon.removeClass("hidden"):n.linkIcon.addClass("hidden")}).change(),n.selected=function(){n.element.hasClass("selected")?(t.find("ul li").removeClass("selected"),selectedMenuOption=!1):(t.find("ul li").removeClass("selected"),i(n.element).addClass("selected"),selectedMenuOption=n),o.change()},n.element.click(n.selected),productOptions[r]=n.label,n.label.blur(function(){updateVariationLabels()}),n.deleteButton.unbind("click"),n.deleteButton.click(function(){1==a.itemsElement.children().length?deleteVariationPrices([r],!0):deleteVariationPrices([r]),n.element.remove()}),s?addVariationPrices():addVariationPrices(r),t.dequeue().animate({scrollTop:t.prop("scrollHeight")-t.height()},200),n.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),n.label.blur(),l.focus())}),a.items.push(n)},a.items=new Array,e&&e.options?i.each(e.options,function(){a.addOption(this)}):(a.addOption(),a.addOption()),a.itemsElement.sortable({axis:"y",update:function(){orderVariationPrices()}}),a.element.unbind("click",a.click).click(function(){a.selected(),i(l).unbind("click").click(a.addOption)}),optionMenus[variationsidx++]=a,a.deleteButton.unbind("click").click(function(){var e=new Array;i(a.itemsElement).find("li").not(".ui-sortable-helper").find("input.id").each(function(n,t){e.push(i(t).val())}),deleteVariationPrices(e,!0),i(this).trigger("delete")}),e||(t.dequeue().animate({scrollTop:t.attr("scrollHeight")-t.height()},200),a.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),l.focus())}))}function buildVariations(){var e,i,n,t,l=jQuery,o=new Array,a=l("#variations-list ul"),r=a.length-1,s=new Array(a.length),d=new Array(a.length),c=0;for(a.each(function(e,i){d[e]=l(i).children().length,0==c?c=l(i).children().length:c*=l(i).children().length,s[e]=0}),e=0;e<c;e++){for(i=0;i<a.length;i++)n=l(a[i]).children("li").not(".ui-sortable-helper").children("input.id"),o[e]?o[e].push(l(n[s[i]]).val()):o[e]=[l(n[s[i]]).val()];if(++s[r]>=d[r])for(t=r;t>-1;t--)s[t]<d[t]||(s[t]=0,t-1>-1&&s[t-1]++)}return o}function addVariationPrices(e){if(!e){var i,n,t=jQuery,l=buildVariations(),o=t(t("#variations-pricing")).children(),a=!1;t(l).each(function(e,t){i=xorkey(t),""==(n=xorkey(t.slice(0,t.length-1)))&&(n=-1),Pricelines.row[i]||(Pricelines.row[n]?(Pricelines.row[i]=Pricelines.row[n],delete Pricelines.row[n],Pricelines.row[i].setOptions(t)):(0==o.length?Pricelines.add(t,{context:"variation"},"#variations-pricing"):Pricelines.add(t,{context:"variation"},Pricelines.row[xorkey(l[e-1])].row,"after"),a=!0))}),a&&Pricelines.updateVariationsUI()}}function deleteVariationPrices(e,i){var n,t,l,o,a,r=jQuery,s=buildVariations(),d=!1;r(s).each(function(s,c){for(t=xorkey(c),n=0;n<e.length;n++)-1!=c.indexOf(e[n])&&(l=new Array,r(c).each(function(i,t){t!=e[n]&&l.push(t)}),o=xorkey(l),i&&!Pricelines.row[o]?(0!=o?Pricelines.row[o]=Pricelines.row[t]:Pricelines.row[t].row.remove(),delete Pricelines.row[t],Pricelines.row[o]&&(Pricelines.row[o].setOptions(l),d=!0)):Pricelines.row[t]&&(a=r("#priceid-"+Pricelines.row[t].id).val(),""==r("#deletePrices").val()?r("#deletePrices").val(a):r("#deletePrices").val(r("#deletePrices").val()+","+a),Pricelines.remove(t)))}),d&&Pricelines.updateVariationsUI()}function optionMenuExists(e){if(!e)return!1;var i=jQuery,n=!1;return i.each(optionMenus,function(t,l){if(l&&i(l.label).val()==e)return n=t}),optionMenus[n]?optionMenus[n]:n}function optionMenuItemExists(e,i){if(!e||!e.items||!i)return!1;var n=jQuery,t=!1;return n.each(e.items,function(e,l){if(l&&n(l.label).val()==i)return t=!0}),t}function updateVariationLabels(){jQuery(buildVariations()).each(function(e,i){var n=xorkey(i);Pricelines.row[n]&&Pricelines.row[n].updateLabel()})}function orderOptions(e,i){var n=jQuery;n(e).find("ul li").not(".ui-sortable-helper").find("input.id").each(function(e,t){t&&n(optionMenus[n(t).val()].itemsElement).appendTo(i)}),orderVariationPrices()}function orderVariationPrices(){var e;jQuery(buildVariations()).each(function(i,n){(e=xorkey(n))>0&&Pricelines.row[e]&&Pricelines.reorderVariation(e,n)}),Pricelines.updateVariationsUI("tabs")}function xorkey(e){e instanceof Array||(e=[e]);for(var i=0,n=0;n<e.length;n++)i^=7001*e[n];return i}function variationsToggle(){var e=jQuery,i=e(this),n=e("#variations"),t=e("#product-pricing");i.prop("checked")?(Pricelines.row[0]&&Pricelines.row[0].disable(),t.hide(),n.show()):(n.hide(),t.show(),Pricelines.row[0]&&Pricelines.row[0].enable())}function addonsToggle(){var e=jQuery,i=e(this),n=e("#addons");i.prop("checked")?n.show():n.hide()}function clearLinkedIcons(){jQuery("#variations-list input.linked").val("off").change()}function linkVariationsButton(){var e=jQuery;selectedMenuOption?"off"==selectedMenuOption.linked.val()?(Pricelines.allLinked()&&(clearLinkedIcons(),Pricelines.unlinkAll()),selectedMenuOption.linked.val("on").change(),Pricelines.linkVariations(selectedMenuOption.id.val())):(selectedMenuOption.linked.val("off").change(),Pricelines.unlinkVariations(selectedMenuOption.id.val())):(clearLinkedIcons(),Pricelines.allLinked()?Pricelines.unlinkAll():Pricelines.linkAll()),e(this).change()}function linkVariationsButtonLabel(){var e=jQuery;selectedMenuOption?"on"==selectedMenuOption.linked.val()?e(this).find("small").html(" "+UNLINK_VARIATIONS):e(this).find("small").html(" "+LINK_VARIATIONS):Pricelines.allLinked()?e(this).find("small").html(" "+UNLINK_ALL_VARIATIONS):e(this).find("small").html(" "+LINK_ALL_VARIATIONS)}function loadAddons(e,i){var n=jQuery;e&&(n.each(e,function(e,i){newAddonGroup(i)}),n.each(i,function(e,i){if("addon"==i.context){var n=addonOptionsGroup[i.options];Pricelines.add(i.options,this,"#addon-pricegroup-"+n)}}),Pricelines.updateVariationsUI())}function newAddonGroup(e){var i=jQuery,n=i("#addon-menu"),t=i("#addon-list"),l=i("#newAddonGroup"),o=i("#addAddonOption"),a=addon_group_idx,r=new NestedMenu(a,n,"meta[options][a]",ADDON_GROUP_DEFAULT,e,{target:t,type:"list"},{axis:"y",update:function(){orderAddonGroups()}});r.itemsElement.attr("id","addon-group-"+a),r.pricegroup=i('<div id="addon-pricegroup-'+a+'" />').appendTo("#addon-pricing"),r.pricegroupLabel=i("<label />").html("<h4>"+r.label.val()+"</h4>").prependTo(r.pricegroup),r.updatePriceLabel=function(){r.pricegroupLabel.html("<h4>"+r.label.val()+"</h4>")},r.label.blur(r.updatePriceLabel),r.addOption=function(e){var n,l,a=!1;e||(e=new Object),e.id?e.id>addonsidx&&(addonsidx=e.id):(a=!0,e.id=addonsidx),n=new NestedMenuOption(r.index,r.itemsElement,"meta[options][a]",NEW_OPTION_DEFAULT,e),addonsidx++,l=n.id.val(),n.selected=function(){n.element.hasClass("selected")?(t.find("ul li").removeClass("selected"),selectedMenuOption=!1):(t.find("ul li").removeClass("selected"),i(n.element).addClass("selected"),selectedMenuOption=n)},n.element.click(n.selected),productAddons[l]=n.label,n.label.blur(function(){Pricelines.row[l].updateLabel()}),n.deleteButton.unbind("click"),n.deleteButton.click(function(){var e=Pricelines.row[l].data.id,t=i("#deletePrices");e&&(""==t.val()?t.val(e):t.val(t.val()+","+e)),Pricelines.row[l].row.remove(),n.element.remove()}),a&&Pricelines.add(l,{context:"addon"},r.pricegroup),addonOptionsGroup[l]=r.index,r.items.push(n),t.dequeue().animate({scrollTop:t.attr("scrollHeight")-t.height()},200),n.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),n.label.blur(),o.focus())})},r.items=new Array,e&&e.options?i.each(e.options,function(){r.addOption(this)}):(r.addOption(),r.addOption()),r.itemsElement.sortable({axis:"y",update:function(){orderAddonPrices(r.index)}}),r.element.unbind("click",r.click),r.element.click(function(){r.selected(),i(o).unbind("click").click(r.addOption)}),addonGroups[addon_group_idx++]=r,r.deleteButton.unbind("click").click(function(){i("#addon-list #addon-group-"+r.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,n){var t,l=i(n).val(),o=i("#deletePrices");Pricelines.row[l]&&((t=Pricelines.row[l].data.id)&&(""==o.val()?o.val(t):o.val(o.val()+","+t)),Pricelines.row[l].row.remove())}),r.deleteButton.trigger("delete"),r.pricegroup.remove(),r.element.remove()}),e||(n.dequeue().animate({scrollTop:n.attr("scrollHeight")-n.height()},200),r.label.click().focus().select().keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),r.label.blur(),l.focus())}))}function orderAddonGroups(){var e,i=jQuery;i("#addon-menu ul li").not(".ui-sortable-helper").find("input.id").each(function(n,t){(e=addonGroups[i(t).val()]).pricegroup.appendTo("#addon-pricing")})}function orderAddonPrices(e){var i=jQuery,n=addonGroups[e];i("#addon-list #addon-group-"+n.index+" li").not(".ui-sortable-helper").find("input.id").each(function(e,t){Pricelines.reorderAddon(i(t).val(),n.pricegroup)})}function readableFileSize(e){var i=new Array("bytes","KB","MB","GB"),n=1*e,t=0;if(0==n)return n;for(;n>1e3;)n/=1024,t++;return n.toFixed(2)+" "+i[t]}function addDetail(e){var i,n,t=jQuery,l=t("#details-menu"),o=t("#details-list"),a=new NestedMenu(detailsidx++,l,"details","Detail Name",e,{target:o});if(e&&e.options){n=t('<select name="details['+a.index+'][value]"></select>').appendTo(a.itemsElement),t("<option></option>").appendTo(n);for(i in e.options)t("<option>"+e.options[i].name+"</option>").appendTo(n);e&&e.value&&n.val(htmlentities(e.value))}else a.item=new NestedMenuContent(a.index,a.itemsElement,"details",e);e&&!e.add||(a.add=t('<input type="hidden" name="details['+a.index+'][new]" value="true" />').appendTo(a.element),l.dequeue().animate({scrollTop:l.attr("scrollHeight")-l.height()},200),a.label.click().focus().select(),a.item&&a.item.contents.keydown(function(e){9==(e.keyCode||e.which)&&(e.preventDefault(),t("#addDetail").focus())}))}function ImageUploads(e,i){function n(){t(".lightbox-dropzone li").length>0&&t(".lightbox-dropzone").sortable({opacity:.8})}var t=jQuery;Dropzone.autoDiscover=!1,t.template("image-preview-template",t("#lightbox-image-template"));new Dropzone("ul.lightbox-dropzone",{url:imgul_url+"&type="+i+"&parent="+e,maxFilesize:uploadLimit/1024/1024,autoDiscover:!1,parallelUploads:5,autoProcessQueue:!0,previewTemplate:t.tmpl("image-preview-template").html(),acceptedFiles:"image/*",init:function(){var e=this;t(".image-upload").on("click",function(){e.hiddenFileInput.click()}),e.on("error",function(e,i){t(".lightbox-dropzone li.dz-error").on("click",function(){t(this).fadeOut(300,function(){t(this).remove()})})}),e.on("success",function(e,i){t(e.previewElement).find(".imageid").attr("value",i.id)}),e.on("complete",function(e,i){n()})}});n(),t(".lightbox-dropzone li:not(.dz-upload-control)").each(function(){t(this).dblclick(function(){var e=t(this).attr("id")+"-details",i=t("#"+e),n=i.find("input[type=hidden]").val(),l=i.find("img"),o=i.find("input.imagetitle"),a=i.find("input.imagealt"),r=i.find("input.imagecropped"),s=t('<div class="image-details-editor"><div class="details-editor"><img class="thumb" width="96" height="96" /><div class="details"><p><label>'+IMAGE_DETAILS_TITLE_LABEL+': </label><input type="text" name="title" /></p><p><label>'+IMAGE_DETAILS_ALT_LABEL+': </label><input type="text" name="alt" /></p></div></div><div class="cropping"><p class="clear">'+IMAGE_DETAILS_CROP_LABEL+': <select name="cropimage"><option></option></select></p><div class="cropui"></div><br class="clear"/></div><input type="button" class="button-primary alignright" value="&nbsp;&nbsp;'+IMAGE_DETAILS_DONE+'&nbsp;&nbsp;" /></div>'),d=(s.find("img").attr("src",l.attr("src")),s.find("input[name=title]").val(o.val()).change(function(){o.val(d.val())})),c=s.find("input[name=alt]").val(a.val()).change(function(){a.val(c.val())}),u=(s.find("input[type=button]").click(function(){t.colorbox.close()}),s.find("div.cropping").hide()),p=s.find("div.cropui"),h=s.find("select[name=cropimage]").change(function(){if(""==h.val())return p.empty(),void t.colorbox.resize();var e=h.val().split(":"),i=r.filter("input[alt="+h.val()+"]").val().split(",");p.empty().scaleCrop({imgsrc:"?siid="+n,target:{width:parseInt(e[0],10),height:parseInt(e[1],10)},init:{x:parseInt(i[0],10),y:parseInt(i[1],10),s:new Number(i[2])}}).ready(function(){t.colorbox.resize({innerWidth:parseInt(e[0],10)+125})}).bind("change.scalecrop",function(e,i){i.s||(i.s=1),i&&r.filter("input[alt="+h.val()+"]").val(i.x+","+i.y+","+i.s)})});r.size()>0&&(r.each(function(e,i){var n=t(i).attr("alt");t('<option value="'+n+'">'+(e+1)+": "+n.replace(":","&times;")+"</option>").appendTo(h)}),u.show()),t.colorbox({title:IMAGE_DETAILS_TEXT,html:s})}),function(e){e.hide(),e.parent().hover(function(){e.show()},function(){e.hide()}),e.click(function(){if(confirm(DELETE_IMAGE_WARNING)){var i="<"==e.val().substr(0,1)?e.find("input[name=ieisstupid]").val():e.val(),n=t("#deleteImages"),l=n.val();n.val(""==l?i:l+","+i),t("#confirm-delete-images").show(),e.parent().fadeOut(500,function(){t(this).remove()})}})}(t(this).find("button.delete"))})}function FileUploader(e){var i=jQuery,n=this;this.priceline=!1,i.template("filechooser-upload-template",i("#filechooser-upload-template")),this.dropzone=new Dropzone(e,{url:fileupload_url,autoDiscover:!1,uploadMultiple:!1,autoQueue:!0,autoProcessQueue:!0,chunking:!0,forceChunking:!0,chunkSize:uploadLimit-1024,maxFilesize:4096,parallelChunkUploads:!1,retryChunks:!0,parallelConnectionLimit:uploadMaxConnections,previewTemplate:i.tmpl("filechooser-upload-template").html(),init:function(){var e=this;i(".filechooser-upload").on("mousedown",function(){e.hiddenFileInput.click(),i(e.previewsContainer).empty()}),e.on("addedfile",function(n){i.colorbox.hide(),e.processQueue(),e.options.parallelChunkUploads=!1,n.size/e.options.chunkSize<=e.options.parallelConnectionLimit&&(e.options.parallelChunkUploads=!0),i(e.previewsContainer).find(".icon.shoppui-file").addClass(n.type.replace("/"," "))}),e.on("success",function(t){var l=JSON.parse(t.xhr.response);l.id&&i("<input>").attr({type:"hidden",name:"price["+n.priceline+"][download]",value:l.id}).appendTo(i(e.previewsContainer))})}})}function SlugEditor(e,i){var n=jQuery,t=n("#edit-slug-buttons"),l=t.find(".edit"),o=t.find(".view"),a=n("#editor-slug-buttons"),r=a.find(".save"),s=a.find(".cancel"),d=n("#editable-slug-full");this.permalink=function(){var l,c=0,u=n("#editable-slug"),p=u.html(),h=n("#slug_input"),f=h.html(),m=d.html();for(t.hide(),a.show(),r.unbind("click").click(function(){var l=u.children("input").val(),r=n("#title").val();n.post(editslug_url+"&action=shopp_edit_slug",{id:e,type:i,slug:l,title:r},function(e){u.html(p),-1!=e&&(u.html(e),d.html(e),h.val(e)),o.attr("href",canonurl+d.html()),a.hide(),t.show()},"text")}),s.unbind("click").click(function(){u.html(p),a.hide(),t.show(),h.attr("value",f)}),l=0;l<m.length;++l)"%"==m.charAt(l)&&c++;slug_value=c>m.length/4?"":m,u.html('<input type="text" id="new-post-slug" value="'+slug_value+'" />').children("input").keypress(function(e){var i=e.which;13!=i&&27!=i||e.preventDefault(),13==i&&r.click(),27==i&&s.click(),h.val(this.value)}).focus()},l.click(this.permalink)}jQuery.fn.FileChooser=function(e,i){var n=jQuery,t=this,l=n("#filechooser"),o=l.find(".fileimport"),a=l.find(".status"),r=n("#attach-file"),s=n("#download_path-"+e),d=n("#download_file-"+e),c=n("#file-"+e),u=0;t.line=e,t.status=i,l.unbind("change").on("change",".fileimport",function(e){a.attr("class","status").addClass("shoppui-spinner shoppui-spinfx shoppui-spinfx-steps8"),n.ajax({url:fileverify_url+"&action=shopp_verify_file&t=download",type:"POST",data:"url="+o.val(),timeout:1e4,dataType:"text",success:function(e){if(a.attr("class","status"),"OK"==e)return a.addClass("shoppui-ok-sign");"NULL"==e&&a.attr("title",FILE_NOT_FOUND_TEXT),"ISDIR"==e&&a.attr("title",FILE_ISDIR_TEXT),"READ"==e&&a.attr("title",FILE_NOT_READ_TEXT),a.addClass("shoppui-warning-sign")}})}),o.unbind("keydown").unbind("keypress").suggest(sugg_url+"&action=shopp_storage_suggestions&t=download",{delay:500,minchars:3,multiple:!1,onSelect:function(){o.trigger("change")}}),n(this).click(function(){a.attr("class","status"),fileUploads.dropzone.previewsContainer=c[0],fileUploads.priceline=t.line,r.unbind("click").click(function(){n.colorbox.hide();var i=!1,t=o.val(),l=function(e){if(!e.name)return $this.attr("class","");c.attr("class","file").html('<span class="icon shoppui-file '+e.mime.replace("/"," ")+'"></span>'+e.name+"<br /><small>"+readableFileSize(e.size)+"</small>"),s.val(e.path),d.val(e.name),o.val("").attr("class","fileimport")},a=function(){var t=c.find("div.progress"),o=t.find("div.bar"),r=t.outerWidth(),s=n("#import-file-"+e).get(0).contentWindow,d=s.importProgress,p=s.importFile;if(void 0!==p){if(p.error)return c.attr("class","error").html("<small>"+p.error+"</small>");if(!p.path)return c.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>");if(p.stored)return l(p);savepath=p.path.split("/"),i=savepath[savepath.length-1]}if(d||(d=0),0===d&&u++>60)return c.attr("class","error").html("<small>"+FILE_UNKNOWN_IMPORT_ERROR+"</small>");o.animate({width:Math.ceil(d*r)+"px"},100),1!=d?setTimeout(a,100):o&&o.css({width:"100%"}).fadeOut(500,function(){l(p)})};setTimeout(a,100),c.attr("class","").html('<div class="progress"><div class="bar"></div><div class="gloss"></div></div><iframe id="import-file-'+e+'" width="0" height="0" src="'+fileimport_url+"&action=shopp_import_file&url="+t+'"></iframe>')})}),n(this).colorbox({title:"File Selector",innerWidth:"360",innerHeight:"140",inline:!0,href:l})};