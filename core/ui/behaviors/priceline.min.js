function Pricelines(){var e=jQuery,i=this;i.idx=0,i.row=new Object,i.variations=new Array,i.addons=new Array,i.linked=new Array,i.add=function(n,t,a,l){t||(t={context:"product"});var o,r,s,p;"variation"==t.context?(o=xorkey(n),r=new Priceline(i.idx,n,t,a,l),i.row[o]=r,l?(s=parseInt(a.optionkey.val(),10),p=e.inArray(s,i.variations),p!=-1&&("before"==l?i.variations.splice(p,0,xorkey(r.options)):i.variations.splice(p+1,0,xorkey(r.options)))):i.variations.push(xorkey(r.options))):"addon"==t.context?(r=new Priceline(i.idx,n,t,a,l),i.row[n]=r):"product"==t.context&&(r=new Priceline(0,n,t,a,l),i.row[0]=r),e("#prices").val(i.idx++)},i.exists=function(e){return!!i.row[e]},i.remove=function(n){var t=e.inArray(n,i.variations);t!=-1&&i.variations.splice(t,1),i.row[n].row.remove(),delete i.row[n]},i.reorderVariation=function(n,t){var a=i.row[n],l=e.inArray(n,i.variations);a.row.appendTo("#variations-pricing"),a.setOptions(t),l!=-1&&(i.variations.splice(l,1),i.variations.push(xorkey(a.options)))},i.reorderAddon=function(e,n){var t=i.row[e];t.row.appendTo(n)},i.updateVariationsUI=function(n){var t,a,l,o;for(t in i.variations)if(a=i.variations[t],Pricelines.row[a]){if(l=Pricelines.row[a],l.updateTabIndex(t),!n||"tabs"!=n){l.unlinkInputs();for(o in i.linked)e.inArray(o,i.row[a].options)!=-1&&(i.linked[o][a]||i.linked[o].push(a),i.row[a].linkInputs(o))}}else delete i.variations[t]},i.linkVariations=function(n){if(n)for(var t in i.row)e.inArray(n.toString(),i.row[t].options)!=-1&&(i.linked[n]||(i.linked[n]=new Array),i.linked[n].push(t),i.row[t].linkInputs(n))},i.unlinkVariations=function(e){if(e&&i.linked[e]){for(var n in i.linked[e])i.row[i.linked[e][n]]&&i.row[i.linked[e][n]].unlinkInputs(e);i.linked.splice(e,1)}},i.unlinkAll=function(){for(var e in i.row)i.row[e].unlinkInputs();i.linked.splice(0,1)},i.updateVariationLinks=function(){if(i.linked){var e,n;for(e in i.row)i.row[e].unlinkInputs();for(n in i.linked)i.linked[n]=!1,i.linkVariations(n)}},i.allLinked=function(){return!!i.linked[0]},i.linkAll=function(){i.unlinkAll(),i.linked=new Array,i.linked[0]=new Array;for(var e in i.row)0!=e&&(i.linked[0].push(e),i.row[e].linkInputs(0))}}function Priceline(e,i,n,t,a){var l,o,r,s,p,d,c,u,h,v,f,b,m,g,w=jQuery,y=this,k=template,L=Pricelines,T="";y.id=e,y.options=i,y.data=n,y.label=!1,y.links=new Array,y.inputs=new Array,y.lasttype=!1,l=y.id,o="price["+l+"]",y.row=w('<div id="row-'+l+'" class="priceline" />'),"after"==a?y.row.insertAfter(t):"before"==a?y.row.insertBefore(t):y.row.appendTo(t),r=w('<div class="pricing-label" />').appendTo(y.row),s=w('<label for="label-'+l+'" />').appendTo(r),y.label=w('<input type="hidden" name="price['+l+'][label]" id="label-'+l+'" />').appendTo(r),w(y.row).on("change.label","#label-"+l,function(){s.text(w(this).val())}),n.id||(n.id=""),n.product||(n.product=product),n.donation||(n.donation={"var":!1,min:!1}),n.dimensions||(n.dimensions={weight:0,height:0,width:0,length:0}),w('<input type="hidden" name="'+o+'[id]" id="priceid-'+l+'" value="'+n.id+'" /><input type="hidden" name="'+o+'[product]" id="product-'+l+'" value="'+n.product+'" /><input type="hidden" name="'+o+'[context]" id="context-'+l+'"/><input type="hidden" name="'+o+'[optionkey]" id="optionkey-'+l+'" class="optionkey" /><input type="hidden" name="'+o+'[options]" id="options-'+l+'" value="" /><input type="hidden" name="sortorder[]" id="sortorder-'+l+'" value="'+l+'" />').appendTo(r),p=w("#priceid-"+l),d=w("#context-"+l),c=w("#options-"+l),u=w("#sortorder-"+l),h=w("#optionkey-"+l),y.row.optionkey=h,w(priceTypes).each(function(e,i){"addon"==n.context&&"Subscription"==i.label||(T+='<option value="'+i.value+'">'+i.label+"</option>")}),v=w('<select name="price['+l+'][type]" id="type-'+l+'"></select>').html(T).appendTo(r),n&&n.label&&(y.label.val(htmlentities(n.label)).change(),v.val(n.type)),f=w('<div class="pricing-ui clear" />').appendTo(y.row),b=w("<table/>").addClass("pricing-table").appendTo(f),m=w("<tr/>").appendTo(b),g=w("<tr/>").appendTo(b),y.price=function(e,i){var n,t;n=w('<th><label for="price-'+l+'">'+PRICE_LABEL+"</label></th>").appendTo(m),t=w('<td><input type="text" name="'+o+'[price]" id="price-'+l+'" value="0" size="10" class="selectall money right" /><br /><input type="hidden" name="'+o+'[tax]" value="on" /><input type="checkbox" name="'+o+'[tax]" id="tax-'+l+'" value="off" /><label for="tax-'+l+'"> '+NOTAX_LABEL+"</label><br /></td>").appendTo(g),y.p=w("#price-"+l).val(asMoney(new Number(e||0))),y.t=w("#tax-"+l).prop("checked","off"==i)},y.saleprice=function(e,i){var n,t,a;n=w('<th><input type="hidden" name="'+o+'[sale]" value="off" /><input type="checkbox" name="'+o+'[sale]" id="sale-'+l+'" value="on" /><label for="sale-'+l+'"> '+SALE_PRICE_LABEL+"</label></th>").appendTo(m),t=w('<td><span class="status">'+NOT_ON_SALE_TEXT+'</span><span class="ui"><input type="text" name="'+o+'[saleprice]" id="saleprice-'+l+'" size="10" class="selectall money right" /></span></td>').appendTo(g),a=t.find("span.status"),t=t.find("span.ui").hide(),y.sp=w("#saleprice-"+l).val(asMoney(new Number(i||0))),y.spt=w("#sale-"+l).prop("checked","on"==e),y.toggler(y.spt,a,t,y.sp)},y.donation=function(e,i,n,t){var a,r,s,p;a=w('<th><label for="price-'+l+'"> '+AMOUNT_LABEL+"</label></th>").appendTo(m),r=w('<td><input type="text" name="'+o+'[price]" id="price-'+l+'" value="0" size="10" class="selectall money right" /><br /><input type="hidden" name="'+o+'[tax]" value="on" /><input type="checkbox" name="'+o+'[tax]" id="tax-'+l+'" value="off" /><label for="tax-'+l+'"> '+NOTAX_LABEL+"</label><br /></td>").appendTo(g),y.p=w("#price-"+l).val(asMoney(new Number(e||0))),y.t=w("#tax-"+l).prop("checked","on"!=i),s=w("<th />").appendTo(m),p=w('<td width="80%"><input type="hidden" name="'+o+'[donation][var]" value="off" /><input type="checkbox" name="'+o+'[donation][var]" id="donation-var-'+l+'" value="on" /><label for="donation-var-'+l+'"> '+DONATIONS_VAR_LABEL+'</label><br /><input type="hidden" name="'+o+'[donation][min]" value="off" /><input type="checkbox" name="'+o+'[donation][min]" id="donation-min-'+l+'" value="on" /><label for="donation-min-'+l+'"> '+DONATIONS_MIN_LABEL+"</label><br /></td>").appendTo(g),y.dv=w("#donation-var-"+l).prop("checked","on"==n),y.dm=w("#donation-min-"+l).prop("checked","on"==t)},y.shipping=function(e,i,n){function t(){var e=0,i=0;c.find("input").each(function(n,t){w(t).hasClass("weight")?i=asNumber(t.value):0==e?e=asNumber(t.value):e*=asNumber(t.value)}),isNaN(e/i)||y.w.val(e/i).trigger("change.value")}function a(){y.w.toggleClass("extoggle"),c.toggle(),y.dw.focus(),t()}var r,s,p,d,c,u,h=getCurrencyFormat();h.precision="2",r=w('<th><input type="hidden" name="'+o+'[shipping]" value="off" /><input type="checkbox" name="'+o+'[shipping]" id="shipping-'+l+'" value="on" /><label for="shipping-'+l+'"> '+SHIPPING_LABEL+"</label></th>").appendTo(m),s=w('<td><span class="status">'+FREE_SHIPPING_TEXT+'</span><span class="ui"><input type="text" name="'+o+'[dimensions][weight]" id="weight-'+l+'" size="8" class="selectall right" /><label for="weight-'+l+'" id="weight-label-'+l+'" title="'+WEIGHT_LABEL+'"> '+WEIGHT_LABEL+(weightUnit?" ("+weightUnit+")":"")+'</label><br /><span class="dimui"></span><input type="text" name="'+o+'[shipfee]" id="shipfee-'+l+'" size="8" class="selectall money right" /><label for="shipfee-'+l+'" title="'+SHIPFEE_XTRA+'"> '+SHIPFEE_LABEL+"</label><br /></span></td>").appendTo(g),p=s.find("span.status"),d=s.find("span.ui").hide(),dui=s.find(".dimui"),y.w=w("#weight-"+l).val(formatNumber(new Number(i.weight||0),h,!0)),d.on("change.value","#weight-"+l,function(){this.value=formatNumber(isNaN(this.value)?0:this.value,h,!0)}),y.fee=w("#shipfee-"+l),y.fee.val(asMoney(new Number(n||0))),y.st=r.find("#shipping-"+l).prop("checked","off"!=e),y.toggler(y.st,p,d,y.w),dimensionsRequired&&(u=function(){$this.val(formatNumber($this.val(),h,!0))},w("#weight-label-"+l).html(" "+dimensionUnit+"<sup>3</sup>/"+weightUnit),c=w('<div class="dimensions"><div class="inline"><input type="text" name="'+o+'[dimensions][weight]" id="dimensions-weight-'+l+'" size="4" class="selectall right weight" />'+(weightUnit?"<label>"+weightUnit+"&nbsp;</label>":"")+'<br /><label for="dimensions-weight-'+l+'" title="'+WEIGHT_LABEL+'"> '+WEIGHT_LABEL+'</label></div><div class="inline"><input type="text" name="'+o+'[dimensions][length]" id="dimensions-length-'+l+'" size="4" class="selectall right" /><label> x </label><br /><label for="dimensions-length-'+l+'" title="'+LENGTH_LABEL+'"> '+LENGTH_LABEL+'</label></div><div class="inline"><input type="text" name="'+o+'[dimensions][width]" id="dimensions-width-'+l+'" size="4" class="selectall right" /><label> x </label><br /><label for="dimensions-width-'+l+'" title="'+WIDTH_LABEL+'"> '+WIDTH_LABEL+'</label></div><div class="inline"><input type="text" name="'+o+'[dimensions][height]" id="dimensions-height-'+l+'" size="4" class="selectall right" /><label>'+dimensionUnit+'</label><br /><label for="dimensions-height-'+l+'" title="'+HEIGHT_LABEL+'"> '+HEIGHT_LABEL+"</label></div></div>").hide().appendTo(dui),i instanceof Object||(i={weight:0,length:0,width:0,height:0}),c.on("change.value","input",u).trigger("change.value"),y.dw=w("#dimensions-weight-"+l).val(new Number(i.weight||0)),y.dl=w("#dimensions-length-"+l).val(new Number(i.length||0)),y.dwd=w("#dimensions-width-"+l).val(new Number(i.width||0)),y.dh=w("#dimensions-height-"+l).val(new Number(i.height||0)),y.st.change(function(){w(this).prop("checked")||c.hide()}),y.dh.blur(a),y.w.click(a).attr("readonly",!0),t())},y.inventory=function(e,i,n){var t,a,r;t=w('<th><input type="hidden" name="'+o+'[inventory]" value="off" /><input type="checkbox" name="'+o+'[inventory]" id="inventory-'+l+'" value="on" /><label for="inventory-'+l+'"> '+INVENTORY_LABEL+"</label></th>").appendTo(m),a=w('<td><span class="status"></span><input type="text" name="'+o+'[sku]" id="sku-'+l+'" size="8" title="'+SKU_XTRA+'" class="selectall" /><label for="sku-'+l+'" title="'+SKU_LABEL_HELP+'"> '+SKU_LABEL+'</label><br /><span class="ui"><input type="text" name="'+o+'[stocked]" id="stock-'+l+'" size="8" class="selectall right" /><label for="stock-'+l+'"> '+IN_STOCK_LABEL+"</label></span></td>").appendTo(g),r=a.find("span.status"),a=a.find("span.ui").hide(),y.stock=w("#stock-"+l).val(new Number(i||0)),a.on("change.value","#stock-"+l,function(){this.value=isNaN(this.value)?0:new Number(this.value).roundFixed(0)}),y.sku=w("#sku-"+l).val(n),y.it=t.find("#inventory-"+l).prop("checked","on"==e),y.toggler(y.it,r,a,y.stock)},y.download=function(e){var i,n,t,a;i=w('<th><label for="download-'+l+'">'+PRODUCT_DOWNLOAD_LABEL+"</label></th>").appendTo(m),n=w('<td width="31%"><input type="hidden" name="'+o+'[downloadpath]" id="download_path-'+l+'"/><input type="hidden" name="'+o+'[downloadfile]" id="download_file-'+l+'"/><div id="file-'+l+'" class="status">'+NO_DOWNLOAD+"</div></td>").appendTo(g),t=w('<td rowspan="2" class="controls" width="75"><button type="button" class="button-secondary" style="white-space: nowrap;" id="file-selector-'+l+'"><small>'+SELECT_FILE_BUTTON_TEXT+"&hellip;</small></button></td>").appendTo(m),y.file=w("#file-"+l),y.selector=w("#file-selector-"+l).FileChooser(l,y.file),e&&e.id&&(a=e.mime.replace("/"," "),y.file.attr("class","file").html('<div class="icon shoppui-file '+a+'"></div>'+e.name+"<br /><small>"+readableFileSize(e.size)+"</small>").click(function(){window.location.href=adminurl+"admin.php?src=download&shopp_download="+e.id}))},y.recurring=function(e){var i,n,t,a,r,s,p,d,c='<option value="0">&infin;</option>';for(s=1;s<31;s++)r+='<option value="'+s+'">'+s+"</option>",s>1&&(c+='<option value="'+s+'">'+s+"</option>");w(billPeriods[0]).each(function(e,i){p+='<option value="'+i.value+'">'+i.label+"</option>"}),w(billPeriods[1]).each(function(e,i){d+='<option value="'+i.value+'">'+i.label+"</option>"}),t=w('<th><input type="hidden" name="'+o+'[recurring][trial]" value="off" /><input type="checkbox" name="'+o+'[recurring][trial]" id="trial-'+l+'" /><label for="trial-'+l+'"> '+TRIAL_LABEL+"</label></th>").appendTo(m),a=w('<td><span class="status">'+NOTRIAL_TEXT+'</span><span class="ui"><select name="'+o+'[recurring][trialint]" id="trialint-'+l+'">'+r+'</select><select name="'+o+'[recurring][trialperiod]" id="trialperiod-'+l+'" class="period">'+p+'</select><br /><input type="text" name="'+o+'[recurring][trialprice]" id="trialprice-'+l+'" value="0" size="10" class="selectall money right" /><label for="trialprice-'+l+'">&nbsp;'+PRICE_LABEL+"</label></span></td>").appendTo(g),i=w('<th><label for="billcycle-'+l+'"> '+BILLCYCLE_LABEL+"</label></th>").appendTo(m),n=w('<td><select name="'+o+'[recurring][interval]" id="interval-'+l+'">'+r+'</select><select name="'+o+'[recurring][period]" id="period-'+l+'" class="period">'+p+'</select><br /><select name="'+o+'[recurring][cycles]" id="cycles-'+l+'">'+c+'</select><label for="cycles'+l+'">&nbsp;'+TIMES_LABEL+"</label></td>").appendTo(g),dis=a.find("span.status"),n=a.find("span.ui").hide(),e||(e={period:1,interval:"d",cycles:0,trialperiod:1,trialint:1,trialprice:0}),y.period=w("#period-"+l).val(e.period),y.interval=w("#interval-"+l).val(e.interval).change(function(){var e=w(this),i=y.period.val();1==e.val()?y.period.html(d):y.period.html(p),y.period.val(i)}).change(),y.cycles=w("#cycles-"+l).val(e.cycles),y.trialperiod=w("#trialperiod-"+l).val(e.trialperiod),y.trialint=w("#trialint-"+l).val(e.trialint).change(function(){var e=w(this),i=y.trialperiod.val();1==e.val()?y.trialperiod.html(d):y.trialperiod.html(p),y.trialperiod.val(i)}).change(),y.trialprice=w("#trialprice-"+l).val(asMoney(new Number(e.trialprice))),y.trial=t.find("#trial-"+l).prop("checked","on"==e.trial).toggler(dis,n,y.trialint)},y.toggler=function(e,i,n,t){e.parent().on("change.toggler",{toggle:e,off:i,ui:n,focal:t},function(e){var i=e.data.toggle,n=e.data.off,t=e.data.ui,a=e.data.focal;i.prop("checked")?(n.hide(),t.show(),a.select()):(n.show(),t.hide())}).trigger("change.toggler")},y.memberlevel=function(){var e,i,n,t;n=["Basic","Silver","Gold","Platinum"],w(n).each(function(e,i){t+='<option value="'+i+'">'+i+"</option>"}),e=w('<th><label for="membership-'+l+'"> '+MEMBERSHIP_LABEL+"</label></th>").appendTo(m),i=w('<td><select name="'+o+'[membership]" id="membership-'+l+'" class="membership">'+t+"</select></td>").appendTo(g)},y.Shipped=function(e){y.price(e.price,e.tax),y.saleprice(e._sale,e.saleprice),y.shipping(e.shipping,e.dimensions,e.shipfee),k||y.inventory(e.inventory,e.stock,e.sku)},y.Virtual=function(e){y.price(e.price,e.tax),y.saleprice(e.sale,e.saleprice),k||y.inventory(e.inventory,e.stock,e.sku)},y.Download=function(e){y.price(e.price,e.tax),y.saleprice(e.sale,e.saleprice),k||y.download(e.download)},y.Donation=function(e){y.donation(e.price,e.tax,e.donation["var"],e.donation.min)},y.Subscription=function(e){y.price(e.price,e.tax),y.saleprice(e.sale,e.saleprice),y.recurring(e.recurring)},y.Membership=function(e){y.price(e.price,e.tax),y.saleprice(e.sale,e.saleprice),y.recurring(),k||y.memberlevel()},v.on("change.value",function(){m.empty(),g.empty();var e=v.val();"Shipped"==e&&y.Shipped(n),"Virtual"==e&&y.Virtual(n),"Download"==e&&y.Download(n),"Donation"==e&&y.Donation(n),"Subscription"==e&&y.Subscription(n),"Membership"==e&&y.Membership(n),moneyInputs(g),quickSelects(g)}).trigger("change.value"),y.disable=function(){y.lasttype=!!v.val()&&v.val(),v.val("N/A").trigger("change.value")},y.enable=function(){y.lasttype&&v.val(y.lasttype).trigger("change.value")},n&&n.context?d.val(n.context):d.val("product"),y.setOptions=function(e){var i=!1;e&&(e!=y.options&&(i=!0),y.options=e),"variation"==d.val()&&h.val(xorkey(y.options)),i&&y.updateLabel()},y.updateKey=function(){h.val(xorkey(y.options))},y.updateLabel=function(){var e=d.val(),i="",n="";y.options&&("variation"==e&&w(y.options).each(function(e,t){""==i?i=w(productOptions[t]).val():i+=", "+w(productOptions[t]).val(),""==n?n=t:n+=","+t}),"addon"==e&&(i=w(productAddons[y.options]).val(),n=y.options)),""==i&&(i=DEFAULT_PRICELINE_LABEL),y.label.val(htmlentities(i)).trigger("change.label"),c.val(n)},y.updateTabIndex=function(e){e=new Number(e),w.each(y.inputs,function(i,n){w(n).attr("tabindex",100*(e+1)+i)})},y.linkInputs=function(e){y.links.push(e),w.each(y.inputs,function(e,i){if(i){var n="change.linkedinputs",t=w(i);"checkbox"==t.attr("type")&&(n="click.linkedinputs"),w(i).bind(n,function(){var i=w(this).val(),n=w(this).attr("checked");w.each(y.links,function(a,l){w.each(L.linked[l],function(a,l){l!=xorkey(y.options)&&L.row[l]&&("checkbox"==t.attr("type")?w(L.row[l].inputs[e]).attr("checked",n):w(L.row[l].inputs[e]).val(i),w(L.row[l].inputs[e]).trigger("change.value"))})})})}})},y.unlinkInputs=function(e){e!==!1&&(index=w.inArray(e,y.links),y.links.splice(index,1)),w.each(y.inputs,function(e,i){if(i){var n="blur.linkedinputs";"checkbox"==w(i).attr("type")&&(n="click.linkedinputs"),w(i).unbind(n)}})},"N/A"!=v.val()&&(y.inputs=new Array(v,y.p,y.t,y.spt,y.sp,y.dv,y.dm,y.st,y.w,y.dw,y.dl,y.dwd,y.dh,y.fee,y.it,y.stock,y.sku,y.period,y.interval,y.cycles,y.trialperiod,y.trialint,y.trialprice,y.trial)),y.updateKey(),y.updateLabel()}jQuery.fn.toggler=function(e,i,n){var t=jQuery,a=t(this);return a.closest("tr").on("change.toggle",a,function(){a.prop("checked")?(e.hide(),i.show()):(e.show(),i.hide())}).trigger("change.toggle"),this};