if(jQuery(document).ready(function(){function t(t){var i=a(this),e=decodeURIComponent(i.val()),n=d.find(".payoption-"+e),o="",c=!1;this!=window&&i.attr&&"radio"==i.attr("type")&&!i.is(":checked")||(a(document).trigger("shopp_paymethod",[e]),m.hide(),0==n.length&&(n=a(".payoption-0")),pm_cards[e]&&pm_cards[e].length>0?(d.find(".payment,.paycard").show(),d.find(".paycard.disabled").setDisabled(!1),"undefined"!=typeof paycards&&(a.each(pm_cards[e],function(t,i){paycards[i]&&(c=paycards[i],o+='<option value="'+c.symbol+'">'+c.name+"</option>")}),b.html(o).change())):(d.find(".payment,.paycard").hide(),d.find(".paycard").setDisabled(!0)),n.show())}function e(){if(0==f.length)return!0;if(f.is(":disabled")||f.is(":hidden"))return!0;var t=f.val().replace(/\D/g,""),i=u.filter(":checked"),e=i.val()?i.val():u.val(),o=!1;return e||(e=p),!!f.val().match(/(X)+\d{4}/)||(!pm_cards[e]||(a.each(pm_cards[e],function(i,e){var n=paycards[e],a=new RegExp(n.pattern.substr(1,n.pattern.length-2));if(t.match(a))return o=n.symbol,b.val(o).change()}),!!n(t)&&o))}function n(t){if(t=t.toString().replace(/\D/g,"").split("").reverse(),!t.length)return!1;var e=0;for(i=0;i<t.length;i++)t[i]=parseInt(t[i],10),e+=i%2?2*t[i]-(t[i]>4?9:0):t[i];return e%10==0}var a=jQuery,o=a("#submit-login-checkout"),c=a("#account-login-checkout"),s=a("#password-login-checkout"),l=a("#guest-checkout"),d=a("#checkout.shopp"),r=d.find(".sameaddress"),u=d.find("[name=paymethod]"),p=decodeURIComponent(d_pm),h=a("#billing-locale"),f=a("#billing-card"),b=a("#billing-cardtype"),m=d.find(".payoption-button"),g=d.find(".payoption-"+p),v=m.find("input"),y=a("#confirm-button"),w=a("#shopp-checkout-function"),k=d.find("li.locale");"process"==d.find("input[name=checkout]").val()&&(m.hide(),0==g.length&&(g=d.find(".payoption-0")),g.show(),u.change(t).change()),a.fn.extend({disableSubmit:function(){return a(this).each(function(){var t=a(this);t.data("label")?$co.submitting:t.val();t.data("timeout",setTimeout(function(){t.enableSubmit(),alert($co.error)},1e3*$co.timeout)).setDisabled(!0).val($co.submitting)})},enableSubmit:function(){return a(this).each(function(){var t=a(this),i=t.data("label")?t.data("label"):t.val();clearTimeout(t.data("timeout")),t.setDisabled(!1).val(i)})}}),v.on("click",function(t){t.preventDefault(),a(this).disableSubmit(),setTimeout(function(){d.submit()},1)}).each(function(){a(this).data("label",a(this).val())}),y.on("click",function(t){t.preventDefault(),a(this).disableSubmit(),setTimeout(function(){d.submit()},1)}).each(function(){a(this).data("label",a(this).val())}),d.on("shopp_validate",function(){e()||d.data("error",[$co.badpan,f.get(0)]),d.data("error").length>0&&v.enableSubmit()}),f.change(e),b.change(function(){var t=new String(b.val()).toLowerCase(),i=paycards[t];a(".paycard.xcsc").setDisabled(!0),i&&i.inputs&&a.each(i.inputs,function(t,i){a("#billing-xcsc-"+t).setDisabled(!1)})}).change(),b.change(function(){var t=new String(b.val()).toLowerCase();for(var i in paycards)d.hasClass("cardtype-"+i)&&d.removeClass("cardtype-"+i);d.addClass("cardtype-"+t)}).change(),0==h.children().size()&&k.hide(),o.click(function(t){d.unbind("submit.validate").bind("submit.validlogin",function(t){var i=!1;return""==s.val()&&(i=[$co.loginpwd,s]),""==c.val()&&(i=[$co.loginname,c]),i?(t.preventDefault(),d.unbind("submit.validlogin").bind("submit.validate",function(t){return validate(this)}),alert(i[0]),i[1].focus().addClass("error"),!1):void w.val("login")})}),a("#billing-country, .billing-state, #shipping-country, .shipping-state").bind("change.localemenu",function(t,i){var e,n,o=!!r.is(":checked")&&r.val(),c="shipping"==o?a("#billing-country").val():a("#shipping-country").val(),s="shipping"==o?a('.billing-state[disabled!="true"]').val():a('.shipping-state[disabled!="true"]').val(),l=c+s;i||!h.get(0)||!o&&(a(this).is("#billing-country")||a(this).is(".billing-state"))||(h.empty().attr("disabled",!0),(locales&&(n=locales[l])||(n=locales[c]))&&(e+="<option></option>",a.each(n,function(t,i){e+='<option value="'+i+'">'+i+"</option>"}),a(e).appendTo(h),h.removeAttr("disabled"),k.show()))}),l.change(function(t){var i=d.find("input.passwords"),e=[];a.each(i,function(){e.push("label[for="+a(this).attr("id")+"]")}),e=d.find(e.join(",")),l.is(":checked")?(i.setDisabled(!0).hide(),e.hide()):(i.setDisabled(!1).show(),e.show())}).trigger("change"),a("#shopp form").on("change",".shipmethod",function(){if(a.inArray(a("#checkout #shopp-checkout-function").val(),["process","confirmed"])!=-1){var t=".shopp-cart.cart-",i="span"+t,e="input"+t,n=["shipping","tax","total"],o=[],c={},s=0,l=".shopp .shipmethod, .payoption-button input",d=a(this),r=function(){a(l).attr("disabled",!0),a.getJSON($co.ajaxurl+"?action=shopp_ship_costs&method="+d.val(),function(t){return!t&&s++<2?setTimeout(r,1e3):(a(l).attr("disabled",!1),void a.each(n,function(n,o){return t&&void 0!=t[o]?(a(i+o).html(asMoney(new Number(t[o]))),void a(e+o).val(new Number(t[o]))):void a(i+o).html(c[o])}))})};a.each(n,function(t,e){o.push(i+e),c[e]=a(i+e).html()}),c_upd||(c_upd="?"),a(o.join(",")).html(c_upd),r()}else a(this).parents("form").submit()}),a(window).load(function(){a(document).trigger("shopp_paymethod",[u.val()])}).unload(function(){v.enableSubmit()})}),!locales)var locales=!1;