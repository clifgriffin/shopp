!function(e){e.suggest=function(t,l){function s(){var e=d.offset();v.css({top:e.top+d.outerHeight()+l.yoffset+"px",left:e.left+"px"})}function a(e){if(/27$|38$|40$/.test(e.keyCode)&&v.is(":visible")||/^13$|^9$/.test(e.keyCode)&&f())switch(e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,e.returnValue=!1,e.keyCode){case 38:m();break;case 40:p();break;case 9:case 13:h();break;case 27:v.hide()}else g.val().length!=S&&(C&&clearTimeout(C),C=setTimeout(i,l.delay),S=g.val().length)}function i(){var t,s,a=e.trim(g.val());0==a.length&&l.autoSuggest&&(a=l.autoSuggest),l.multiple&&(t=a.lastIndexOf(l.multipleSep),t!=-1&&(a=e.trim(a.substr(t+l.multipleSep.length)))),a.length>=l.minchars?(cached=u(a),cached?c(cached.items):e.get(l.source,{q:a},function(t){v.hide(),s="json"==l.format?e.parseJSON(t):o(t,a),c(s),r(a,s,t.length)})):v.hide()}function n(){var e=!1;e&&clearTimeout(e),e=setTimeout(i,3e3),g.blur(function(){clearTimeout(e)})}function u(e){var t;for(t=0;t<b.length;t++)if(b[t].q==e)return b.unshift(b.splice(t,1)[0]),b[0];return!1}function r(e,t,s){for(var a;b.length&&y+s>l.maxCacheSize;)a=b.pop(),y-=a.size;b.push({q:e,size:s,items:t}),y+=s}function c(t){var a,i="";if(!t)return void(l.label&&v.html("<li>"+l.label+"</li>").show());if(!t.length)return void(l.label&&v.html("<li>"+l.label+"</li>").show());if(s(),"json"==l.format)for(a=0;a<t.length;a++)i+='<li alt="'+t[a].id+'">'+t[a].name+"</li>";else for(a=0;a<t.length;a++)i+="<li>"+t[a]+"</li>";v.html(i).show(),v.children("li").mouseover(function(){v.children("li").removeClass(l.selectClass),e(this).addClass(l.selectClass)}).click(function(e){e.preventDefault(),e.stopPropagation(),h()}),l.autoSelect&&p()}function o(t,s){var a,i,n=[],u=t.split(l.delimiter);for(a=0;a<u.length;a++)i=e.trim(u[a]),i&&(i=i.replace(new RegExp(s,"ig"),function(e){return'<span class="'+l.matchClass+'">'+e+"</span>"}),n[n.length]=i);return n}function f(){var e;return!!v.is(":visible")&&(e=v.children("li."+l.selectClass),e.length||(e=!1),e)}function h(){$currentResult=f(),$currentResult&&(l.multiple?(g.val().indexOf(l.multipleSep)!=-1?$currentVal=g.val().substr(0,g.val().lastIndexOf(l.multipleSep)+l.multipleSep.length):$currentVal="",g.val($currentVal+$currentResult.text()+l.multipleSep),g.focus()):"alt"==l.value?g.val($currentResult.attr("alt")):g.val($currentResult.text()).attr("alt",$currentResult.attr("alt")),v.hide(),l.onSelect&&l.onSelect.apply(g[0]))}function p(){$currentResult=f(),$currentResult?$currentResult.removeClass(l.selectClass).next().addClass(l.selectClass):v.children("li:first-child").addClass(l.selectClass)}function m(){var e=f();e?e.removeClass(l.selectClass).prev().addClass(l.selectClass):v.children("li:last-child").addClass(l.selectClass)}var d,g,v,C,S,b,y;if(d=e(t),input=d.is("input")?d:d.find("input"),g=e(input).attr("autocomplete","off"),v=e("<ul/>").appendTo("body"),C=!1,S=0,b=[],y=0,v.addClass(l.resultsClass).appendTo("body"),s(),e(window).load(s).resize(s),g.blur(function(){setTimeout(function(){v.hide()},200)}),l.showOnFocus&&g.focus(function(){s(),c(),l.autoSuggest&&n()}),e.ua.msie)try{v.bgiframe()}catch($){}e.ua.mozilla?g.keypress(a):g.keydown(a)},e.fn.suggest=function(t,l){if(t)return l=l||{},l.multiple=l.multiple||!1,l.multipleSep=l.multipleSep||", ",l.showOnFocus=l.showOnFocus||!1,l.source=t,l.yoffset=l.yoffset||0,l.delay=l.delay||100,l.autoDelay=l.autoDelay||3e3,l.autoQuery=l.autoQuery||!1,l.resultsClass=l.resultsClass||"suggest-results",l.selectClass=l.selectClass||"suggest-select",l.matchClass=l.matchClass||"suggest-match",l.minchars=l.minchars||2,l.delimiter=l.delimiter||"\n",l.format=l.format||"string",l.label=l.label||!1,l.value=l.value||"text",l.onSelect=l.onSelect||!1,l.autoSelect=l.autoSelect||!1,l.maxCacheSize=l.maxCacheSize||65536,this.each(function(){new e.suggest(this,l)}),this}}(jQuery);